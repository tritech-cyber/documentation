/* v2.3.190 */
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function Pr(t){function e(t){r._state===PENDING&&(r._state=RESOLVED,r._value=t,r._run_thens())}function s(t){r._state===PENDING&&(r._state=REJECTED,r._value=t,r._run_catches())}var r=this;if(this._state=PENDING,this._value=null,this._thens_queue=[],this._catches_queue=[],"function"==typeof t)try{t(e,s)}catch(t){this._state=REJECTED,this._value=t,this._run_catches()}}var PENDING=1,CANCELED=2,REJECTED=3,RESOLVED=4;Pr.is_promise=function(t){return t&&"function"==typeof t.then&&"function"==typeof t.catch},Pr.get_finished_promise=function(t,e){var s=new Pr;return s._state=t,s._value=e,s},Pr.prototype._run=function(t){if(this.state===PENDING)try{var e=this._fn(t);if(Pr.is_promise(e))switch(e._state){case PENDING:return e._thens_queue=e._thens_queue.concat(this._thens_queue),void(e._catches_queue=e._catches_queue.concat(this._catches_queue));case CANCELED:return this._state=CANCELED;case RESOLVED:return this._state=RESOLVED,this._value=e._value,void this._run_thens();case REJECTED:return this._state=REJECTED,this._value=e._value,void this._run_catches()}else this._state=RESOLVED,this._value=e,this._run_thens()}catch(t){this._state=REJECTED,this._value=t,this._run_catches()}},Pr.prototype._run_catches=function(t){this._value=t||this._value,this._state===PENDING&&(this._state=REJECTED);for(var e=0;e<this._catches_queue.length;++e)this._catches_queue[e]._run(this._value);for(var e=0;e<this._thens_queue.length;++e)this._thens_queue[e]._run_catches(this._value)},Pr.prototype._run_thens=function(t){this._value=t||this._value,this._state===PENDING&&(this._state=RESOLVED);for(var e=0;e<this._thens_queue.length;++e)this._thens_queue[e]._run(this._value);for(var e=0;e<this._catches_queue.length;++e)this._catches_queue[e]._run_thens(this._value)},Pr.prototype._finish=function(t,e){if(this._state===PENDING)switch(this._state=t,this._value=e,this._state){case RESOLVED:return this._run_thens();case REJECTED:return this._run_catches()}},Pr.resolve=function(t){return Pr.get_finished_promise(RESOLVED,t)},Pr.reject=function(t){return Pr.get_finished_promise(REJECTED,t)},Pr.all=function(t){var e=new Pr;if(0===t.length)return e._finish(RESOLVED,null),e;for(var s=t.length,r=[],i=0,n=0;n<s;++n)!function(n){t[n].then(function(t){r[n]=t,++i===s&&e._finish(RESOLVED,r)}).catch(function(t){e._finish(REJECTED,t)})}(n);return e},Pr.defer=function(){var t,e,s=new Pr(function(s,r){t=s,e=r});return{resolve:t,reject:e,promise:s}},Pr.prototype.then=function(t){var e,s;switch(this._state){case PENDING:var s=new Pr;return s.state=PENDING,s._fn=t,this._thens_queue.push(s),s;case RESOLVED:try{return e=t(this._value),Pr.is_promise(e)?e:Pr.get_finished_promise(RESOLVED,e)}catch(t){return Pr.get_finished_promise(REJECTED,t)}case REJECTED:case CANCELED:return this}},Pr.prototype.catch=function(t){var e,s;switch(this._state){case PENDING:var s=new Pr;return s.state=PENDING,s._fn=t,this._catches_queue.push(s),s;case RESOLVED:return this;case REJECTED:try{return e=t(this._value),Pr.is_promise(e)?e:Pr.get_finished_promise(RESOLVED,e)}catch(t){return Pr.get_finished_promise(REJECTED,t)}case CANCELED:return this}},Pr.prototype._catch=Pr.prototype.catch,Pr.prototype.cancel=function(){return this._state===PENDING&&(this._state=CANCELED),this},Pr.prototype.isCancelled=function(){return this._state===CANCELED},Pr.prototype.isRejected=function(){return this._state===REJECTED},Pr.prototype.isResolved=function(){return this._state===RESOLVED},Pr.prototype.isPending=function(){return this._state===PENDING},module.exports=Pr;
},{}],2:[function(require,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],3:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],4:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};
},{}],5:[function(require,module,exports){
(function (process,global){
function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c="",a=!1,l=["{","}"];if(isArray(r)&&(a=!0,l=["[","]"]),isFunction(r)){c=" [Function"+(r.name?": "+r.name:"")+"]"}if(isRegExp(r)&&(c=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(c=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(c=" "+formatError(r)),0===o.length&&(!a||0==r.length))return l[0]+c+l[1];if(t<0)return isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var p;return p=a?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,a)}),e.seen.pop(),reduceToSingleString(p,c,l)}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;s<u;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,c;if(c=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue(e,c.value,null):formatValue(e,c.value,t-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){var n=0;return e.reduce(function(e,r){return n++,r.indexOf("\n")>=0&&n++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(e){return"[Circular]"}default:return e}}),s=n[t];t<i;s=n[++t])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o},exports.deprecate=function(e,r){function t(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(!0===process.noDeprecation)return e;var n=!1;return t};var debugs={},debugEnviron;exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./support/isBuffer":4,"_process":2,"inherits":3}],6:[function(require,module,exports){
"use strict";var utils=require("./utils"),AdsLoader=require("./adsLoader"),Campaign=function(t){this.adsLoader=null,this.adsManager=null,this.adDisplayContainer=null,this.imaAd=null,this.imaContainer=null,this.data=t,this.data.useIma=utils.useIma(vpaid.parameters,this),this.data.skipButtonEnabled=vpaid.settings.skipButtonEnabled||t.skipButtonEnabled,this.status=CONST.CAMPAIGN_STATUS.READY,this.redirectsCount=0,this.active=!0,this.subscribes={},this.tm_events={},utils.implementPubSub(this),this.was_impression=!1};Campaign.prototype.tryPlayNext=function(){if(!this.adpod&&this.selectedAd.isVast)return Promise.resolve(!0);if(!this.adpod)return Promise.resolve(!1);if(0==this.ads.pod.length)return Promise.resolve(!0);if(this.selectedAd=this.selectNextAd(),!this.selectedAd)return Promise.reject(new Error("cant get next from adpod"));var t=this;return this.handshake().then(this.subscribeAll.bind(this)).then(function(){t.vpaidInterface.subscribe(function(){t.vpaidInterface.startAd()},"AdLoaded")}).then(this.initAd.bind(this))},Campaign.prototype.selectNextAd=function(){return this.ads.pod?(this.adpod=!0,this.ads.pod.shift()):this.ads.buffet?this.ads.buffet.shift():null},Campaign.prototype.loadAndParse=function(){if(this.loaded)return Promise.resolve();var t=this,e=this.data.link?utils.prepareInternalUrl(this.data.link,vpaid.parameters,vpaid.settings.macro):"",a=new AdsLoader;return this.logCampaignXMLRequested(),this.currentStagePromise=a.load(e,void 0,this.data.isCheckAccessControl,this.data.vast).then(function(e){if(t.loaded=!0,t.ads=e,t.selectedAd=t.selectNextAd(),!t.selectedAd)throw new Error(CONST.CAMPAIGN_ERRORS.xml_empty);if(t.checkSpotxWO())throw new Error(CONST.CAMPAIGN_ERRORS.spotx_wo_error);t.setRevShare()})},Campaign.prototype.logCampaignXMLRequested=function(){this.log({event:"CampaignXMLRequested"}),this.logThirdPartyTrackers("AdRequest")},Campaign.prototype.logCampaignXMLReceived=function(){this.log({event:"CampaignXMLReceived"})},Campaign.prototype.setRevShare=function(){if(!this.data.revShareCost&&this.isRevShare()){var t=this.selectedAd.getRevShare();this.data.revShareCost=t,t&&(this.data.priority=10*this.getPriority()/(.75*t))}},Campaign.prototype.getPriority=function(){return this.isRtb()?1:this.data.priority},Campaign.prototype.setStatus=function(t){return CONST.CAMPAIGN_ERRORS.UNKNOWN,this.status=t,this},Campaign.prototype.isErrored=function(){return this.status>=CONST.CAMPAIGN_ERRORS.UNKNOWN},Campaign.prototype._score=function(t){var e=this;return scoringManager[t](e).then(function(t){if(!0!==t)throw new Error(CONST.CAMPAIGN_ERRORS.scoring_error)})},Campaign.prototype.score=function(){return this._score("score")},Campaign.prototype.firewall=function(){return this._score("firewall")},Campaign.prototype.vms2s=function(){return this._score("vms2s")},Campaign.prototype.handshake=function(){return this.selectedAd.getVpaidInterface(this.data).then(function(t){this.vpaidInterface=t,this.vpaidInterface.handshakeVersion("2.0")}.bind(this))},Campaign.prototype.log=function(t){var e=this.data;t=t||{},t=_.extend({cmpId:e.cmpId,protocol:"CampaignXMLRequested"==t.event?this.getType():this.getCreativeType(),waterfall_position:e._waterFallIndex,waterfall_id:e.feedId,advId:e.advId},t),newStat.log(t)},Campaign.prototype.getType=function(){return utils.useIma(vpaid.parameters,this)?"ima":this.selectedAd&&this.selectedAd.creativeType?this.selectedAd.creativeType:"vpaidjs"},Campaign.prototype.getCreativeType=function(){var t=this.getType();return"combined"==t?"vpaidjs":t},Campaign.prototype.initAd=function(){utils.log("CMP",this.data.cmpId,"got to initAd");var t=this;oldStat.startTimer(),newStat.startTimer();var e=t.selectedAd.getParameters();e&&!e.AdParameters&&(e={AdParameters:e}),t.vpaidInterface.initAd(vpaid.parameters.width,vpaid.parameters.height,vpaid.parameters.viewMode,vpaid.parameters.bitrate,e,{slot:vpaid.parameters.envParameters.innerSlot||vpaid.parameters.envParameters.slot,videoSlot:vpaid.parameters.envParameters.videoSlot,flashSlot:vpaid.parameters.envParameters.flashSlot}),t.on(CONST.VPAID_EVENTS.AdError,function(e){183566===t.data.cmpId&&newStat.sendPostData(JSON.stringify(e),"183566Error",this.data.cmpId),t.log({event:"CampaignError",type:CONST.CAMPAIGN_ERRORS.vpaid_ad_error})}.bind(this))},Campaign.prototype.vpaidCall=function(t,e){if(this.adsManager){switch("resizeAd"==t&&(e[2]="normal"),t){case"getAdDuration":return this.imaAd?this.imaAd.getDuration():0;case"getAdLinear":return this.imaAd.isLinear();case"getAdHeight":return this.imaAd.getHeight();case"getAdWidth":return this.imaAd.getWidth();case"pauseAd":this.imaPaused=!0;break;case"resumeAd":this.imaPaused=!1;break;case"skipAd":if(-1==this._imaOffset)return this.emit("skip",{event:"AdSkipped"})}return this.adsManager[CONST.IMA_METHODS_MAP[t]].apply(this.adsManager,e)}var a;switch(this.vpaidInterface&&this.vpaidInterface[t]?(utils.log("CMP",this.data.cmpId,"Calling directly client method",t),a=this.vpaidInterface[t].apply(this.vpaidInterface,e)):utils.log("CMP",this.data.cmpId,"Campaign ad unit has no vpaid method",t),t){case"getAdVolume":(isNaN(+a)||a<0||a>1)&&(a=vpaid.parameters.player.volume)}return a},Campaign.prototype.getSkipOffset=function(){try{return this.imaAd?-1===this.getImaSkipOffset()?CONST.DEFAULT_SKIP_OFFSET:this.getImaSkipOffset():this.selectedAd.selectedCreative.skipOffset}catch(t){}return-1},Campaign.prototype.getImaSkipOffset=function(){return this._imaOffset?this._imaOffset:this._imaOffset=this.imaAd.getSkipTimeOffset()},Campaign.prototype.checkSendingPeriod=function(t){var e=CONST.EVENTS_MAX_FREQUENCIES[t]||0,a=this.tm_events[t]||0,i=(new Date).getTime();return!(e&&i-a<e)&&(this.tm_events[t]=i,!0)},Campaign.prototype.handleAdTracking=function(t){this.trackEndPoints(t),this.logThirdPartyTrackers(t),this.logPlayerEvent(t)},Campaign.prototype.trackEndPoints=function(t){var e=this.selectedAd,a=this,i=e.VPAID_TRACKING[t];i&&_.each(i,function(e){"AdError"==t&&(e=e.replace(/\[ERRORCODE\]/g,CONST.VAST_ERROR.GENERAL_VPAID_ERROR)),utils.trackVastEvent(e).catch(function(i){utils.log("can't send vast/vpaid xml event tracking",t,e,a.data.cmpId)})})},Campaign.prototype.logThirdPartyTrackers=function(t){var e=this;this.data.tracking&&this.data.tracking[t]&&this.checkSendingPeriod(t)&&_.each(this.data.tracking[t],function(a){a=utils.prepareUrl(a,vpaid.parameters,vpaid.settings.macro),a=utils.prepareThirdPartyUrl(a,e.data,vpaid.settings),e.data.isTrackerAllowJS&&a.search(/^[^=?]*\.js($|\?)/gi)>=0?a.search(/c\.fqtag\.com\/tag.*org=nuphuc2abrev7gusep3m/i)>=0?scoringManager.trackFqTag(e):utils.loadScript(a):utils.ajaxLoad(a,void 0,void 0,e.data.isCheckAccessControl).catch(function(){utils.log("Custom tracking failed to load",t,a,e.data.cmpId)})})},Campaign.prototype.logPlayerEvent=function(t){if(CONST.VPAID_EVENT_CODES[t]&&this.checkSendingPeriod(t)){var e={event:"PlayerEvent",event_type:CONST.VPAID_EVENT_CODES[t]};vpaid.settings.v2&&(e.is_framed=+!!locationInfo.isInIframe,e.in_focus=+!!utils.isElementFocused(vpaid.parameters.container),e.measure_type=0,e.viewable_percent=utils.getViewablePercent(vpaid.parameters.container),e.duration=this.vpaidCall("getAdDuration")||120,e.page_url=locationInfo.final_page_url),this.log(e)}};var nonBroadCastEvents={AdSkippableStateChange:1};Campaign.prototype.subscribeAll=function(){utils.log("CMP",this.data.cmpId,"subscribe all");var t=this;_.each(CONST.VPAID_EVENTS,function(e){var a=function(a){if(t.active){switch(e){case CONST.VPAID_EVENTS.AdStopped:t.was_impression||(e=CONST.VPAID_EVENTS.AdError,a=void 0,t.active=!1);break;case CONST.VPAID_EVENTS.AdError:t.active=!1}vertadebug.log({event:e,cmpId:t.data.cmpId}),utils.log("CMP",t.data.cmpId,"EVENT:",e,a),t.handleAdTracking(e,a),t.emit(e,{event:e,data:a}),nonBroadCastEvents[e]||t.emit("*",{event:e,data:a})}};try{t.vpaidInterface.subscribe(a,e),t.subscribes[e]=a}catch(a){utils.log("Couldn't subscribe to event"+e,t.data.cmpId)}})},Campaign.prototype.unsubscribeAll=function(){utils.log("CMP",this.data.cmpId,"unsubscribe all");var t=this;t.vpaidInterface&&"function"==typeof t.vpaidInterface.unsubscribe&&(_.each(this.subscribes,function(e,a){try{t.vpaidInterface.unsubscribe(e,a)}catch(e){utils.log("Couldn't unsubscribe from event "+a,t.data.cmpId)}}),this.subscribes=[])},Campaign.prototype.destroy=function(){this.active=!1,this.currentStagePromise&&this.currentStagePromise.cancel(),this.selectedAd&&this.selectedAd.destroy(),this.unsubscribeAll(),this.cmp_timeout&&this.cmp_timeout.reset()},Campaign.prototype.isRevShare=function(){return!!this.data.revshare_tag},Campaign.prototype.isRtb=function(){return!!this.data.isRtb},Campaign.prototype.logError=function(t){if(t=t||{},this.data.useIma&&!t.message){var e=t.getError().getErrorCode();t.message=CONST.IMA_ERRORS_MAP[e]||199}utils.log("CMP",this.data.cmpId,"err",t.message||t),this.log({event:"CampaignError",type:t.message})},Campaign.prototype.checkSpotxWO=function(){try{if(!this.getIsSpotx()||!this.getIsVm())return!1;var t={},e=this.selectedAd.getParameters(),a=JSON.parse(e),i=a.listing&&a.listing.length?a.listing[a.listing.length-1]:a;try{var r=i.client_playback.playback_conf.third_party_tracking;t.dn=r.double_verify_noscript,t.mt=r.moat,t.dv=r.double_verify,t.wo=r.whiteops,t.ig=r.integral}catch(t){}var s=[];try{var n=i.media.tracking.beacon;for(var o in n)"impression"==n[o].type&&s.push(n[o].beacon_url)}catch(t){}try{if(i!=a){var d=a.media.tracking.beacon;for(o in d)"impression"==d[o].type&&s.push(d[o].beacon_url)}}catch(t){}return t.t=i.title,t.ib=s,newStat.sendPostData(JSON.stringify(t),"spotx",this.data.cmpId),"1"==t.wo||1==t.wo||1==t.wo}catch(t){}return!1},Campaign.prototype.getIsVm=function(){return vpaid.settings.isVm||this.data.isVm},Campaign.prototype.getIsSpotx=function(){return this.data.isSpotxchange},module.exports=Campaign;
},{"./adsLoader":10,"./utils":39}],7:[function(require,module,exports){
"use strict";var utils=require("./utils"),Campaign=require("./Campaign"),promiseQueue=require("./queue"),CampaignsManager=function(e){utils.implementPubSub(this),this.cmps=[],e.forEach(function(e){this.add(e)},this),this.createDefferedBlockers(),this.wasAdLoadedEvent=!1};CampaignsManager.prototype.createDefferedBlockers=function(e){var a=this;this.startAdPromise=new Promise(function(e){a.once("vpaidCall"+CONST.VPAID_METHODS.startAd,function(){e("player called start")})})},CampaignsManager.prototype.add=function(e){e instanceof Campaign||(e=new Campaign(e)),this.cmps.push(e)},CampaignsManager.prototype.remove=function(e){this.stop(),UI.clear(),this.currentCampaign&&this.currentCampaign.destroy()},CampaignsManager.prototype.sort=function(){utils.log("BEFORE SORT ",this.cmps.map(function(e){return e.data.cmpId}),this.cmps.map(function(e){return e.getPriority()})),100*Math.random()<vpaid.settings.randomShufflePercent?this.cmps=this.cmps.sort(function(e,a){return e.data.tierIndex-a.data.tierIndex||(e.data.isAuto?Math.random()-.5:e.data.manualIndex-a.data.manualIndex)}):this.cmps=this.cmps.sort(function(e,a){return e.data.tierIndex-a.data.tierIndex||(e.data.isAuto?e.getPriority()-a.getPriority():e.data.manualIndex-a.data.manualIndex)}),utils.log("SORTED AS ",this.cmps.map(function(e){return e.data.cmpId}),this.cmps.map(function(e){return e.getPriority()}))},CampaignsManager.prototype.start=function(e){var a=this,t=[];this.global_timeout=utils.getTimer(function(){this.emit(CONST.CAMPAIGN_MANAGER_EVENTS.GLOBAL_ERROR,"TIMEOUT")}.bind(this),1e3*vpaid.settings.globalTimeout,"globalTimeout");var n=_.map(a.cmps,function(e){return e.firewall().then(e.vms2s.bind(e)).then(function(){return scoringManager.scoreSAS("r",e)}).catch(function(a){e.err=a,t.push(e),e.data._waterFallIndex=1,e.logError(a)})});Promise.all(n).then(function(){a.cmps=_.difference(a.cmps,t);var n=_.filter(a.cmps,function(e){return!(utils.useIma(vpaid.parameters,e)||vpaid.settings.loadOnDemand&&!e.data.revshare_tag)});n=_.map(n,function(e){return e.data._waterFallIndex=a.cmps.indexOf(e)+1,e.loadAndParse().catch(function(a){e.err=a})}),Promise.all(n).then(function(){a.sort(),_.each(a.cmps,function(e,a){e.data._waterFallIndex=1*a+1}),a.threads=new promiseQueue(_.map(a.cmps,function(e){return function(){return a.runCampaign(e)}}),e),a.threads.start().catch(function(e){a.emit(CONST.CAMPAIGN_MANAGER_EVENTS.GLOBAL_ERROR,"ALL_CAMPAIGNS_ERRORED")})})})},CampaignsManager.prototype.vpaidCall=function(e,a){if(e==CONST.VPAID_METHODS.startAd&&this.global_timeout&&this.global_timeout.paused&&this.global_timeout.start(),this.emit("vpaidCall"+e),e!=CONST.VPAID_METHODS.startAd)try{if(this.currentCampaign)return utils.info("CMP",this.currentCampaign.data.cmpId,"MANAGER REACTING:",e,"args:",a),this.currentCampaign.vpaidCall(e,a);utils.log("currentCampaign in undefined")}catch(e){utils.log("vpaid call error",e.message||e)}},CampaignsManager.prototype.stop=function(){this.threads.cancel()},CampaignsManager.prototype.cancelOther=function(e,a){this.threads.cancel(a),_.each(this.cmps,function(a){a!=e&&a.destroy()})},CampaignsManager.prototype.handleAdEnd=function(e,a){var t=this,n=!1;return e.tryPlayNext().then(function(a){return UI.clear(),a&&(t.vpaidCall("stopAd"),e.logPlayerEvent(CONST.VPAID_EVENTS.AdStopped),n=!0),Promise.all([newStat.finalize(),oldStat.finalize()])}).then(function(){t.emit(a.event,a.data),n&&t.emit(CONST.VPAID_EVENTS.AdStopped,a.data)})},CampaignsManager.prototype.AdStoppedHandler=function(e,a){var t=this;UI.clear(),Promise.all([newStat.finalize(),oldStat.finalize()]).then(function(){t.emit(a.event,a.data)})},CampaignsManager.prototype.runCampaign=function(e){var a=this;e.on(CONST.VPAID_EVENTS.AdSkippableStateChange,function(t){!e.data.skipButtonEnabled&&a.emit(t.event,t.data)}),e.on(CONST.VPAID_EVENTS.AdStarted,function(t){e.cmp_timeout&&(e.cmp_timeout.reset(),e.cmp_timeout=null),a.currentCampaign=e;var n=utils.useIma(vpaid.parameters,e);if(n&&e.getImaSkipOffset()>=0&&(e.data.skipButtonEnabled=!0),e.data.skipButtonEnabled){var i,r=!!(n&&vpaid.parameters.height>=400&&vpaid.parameters.width>=800),o=UI.showSkipButton(e.getSkipOffset(),function(){clearInterval(i),n?a.vpaidCall("skipAd")||-1==e._imaOffset&&a.vpaidCall("stopAd"):a.vpaidCall("skipAd")||a.vpaidCall("stopAd")},n,e.imaContainer,r);i=setInterval(function(){o(a.vpaidCall("getAdDuration")-a.vpaidCall("getAdRemainingTime"))&&clearInterval(i)},500),e.on(CONST.VPAID_EVENTS.AdSkippableStateChange,function(){e.vpaidCall("getAdSkippableState")&&(o(100),clearInterval(i))})}});var t=new Defer;e.on(CONST.VPAID_EVENTS.AdImpression,function(){a.global_timeout&&(a.global_timeout.reset(),a.global_timeout=null),i.isCancelled()||(scoringManager.scoreSAS("i",e),e.was_impression=!0,a.cancelOther(e,i),oldStat.sendImpression(e),t.resolve())});var n=new Defer;e.once(CONST.VPAID_EVENTS.AdLoaded,function(t){e.cmp_timeout&&e.cmp_timeout.pause(),!a.wasAdLoadedEvent&&a.global_timeout&&(a.global_timeout.pause(),a.wasAdLoadedEvent=!0),n.resolve(),a.emit(t.event,t.data)});var i=new Promise(function(i,r){function o(a){e.adsManager&&e.adsManager.destroy(),e.logError(a),r(),e.destroy()}if(utils.log("CMP",e.data.cmpId,"waitForImpression",vpaid.settings.waitForImpression),void 0!==e.err)return o(e.err);e.cmp_timeout=utils.getTimer(function(){s&&s.isPending()&&(s.cancel(),o(new Error(""+CONST.CAMPAIGN_ERRORS.campaign_timeout)))},1e3*vpaid.settings.waitForImpression,"CMP "+e.data.cmpId+" impressionTimeout");var s;if(utils.useIma(vpaid.parameters,e)){e.logCampaignXMLRequested(),e.imaContainer=document.createElement("div"),vpaid.parameters.container.appendChild(e.imaContainer);var d=document.createElement,p=!0;document.createElement=function(e){return e&&"video"==e.toLowerCase()&&p?(p=!1,vpaid.parameters.player):d.apply(this,[e])};var l=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,m=new l(function(e){e.forEach(function(e){if("attributes"==e.type&&"src"==e.attributeName){var a=vpaid.parameters.player.src;vpaid.parameters.player.src="",vpaid.parameters.player.autoplay=!0,vpaid.parameters.player.muted=!0,vpaid.parameters.player.src=a,m.disconnect()}})});a.autoPlayAdBreaks=!0,(vpaid.parameters.player.hasAttribute("playsinline")||vpaid.parameters.player.hasAttribute("webkit-playsinline"))&&(vpaid.parameters.player.setAttribute("autoplay",""),vpaid.parameters.player.setAttribute("muted",""),vpaid.parameters.player.autoplay=!0,vpaid.parameters.player.muted=!0,vpaid.parameters.player.volume=0),m.observe(vpaid.parameters.player,{attributes:!0}),s=e.score().then(function(){return scoringManager.scoreSAS("o",e)}).then(e.logCampaignXMLReceived.bind(e)).then(function(){return utils.loadScript("//imasdk.googleapis.com/js/sdkloader/ima3.js")}).then(function(){return google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),e.adDisplayContainer=new google.ima.AdDisplayContainer(e.imaContainer,vpaid.parameters.player),e.adsLoader=new google.ima.AdsLoader(e.adDisplayContainer),new Promise(function(t,n){e.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,t,!1),e.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,n,!1);var i=new google.ima.AdsRequest;i.adTagUrl=utils.prepareUrl(e.data.link,vpaid.parameters),i.setAdWillAutoPlay(a.autoPlayAdBreaks),i.linearAdSlotWidth=vpaid.parameters.width,i.linearAdSlotHeight=vpaid.parameters.height,i.nonLinearAdSlotWidth=vpaid.parameters.width,i.nonLinearAdSlotHeight=vpaid.parameters.height,e.adsLoader.requestAds(i)})}).then(function(t){function n(t,n,i){e.logThirdPartyTrackers(t),e.logPlayerEvent(t),Promise.all(i?[newStat.finalize(),oldStat.finalize()]:[]).then(function(){e.emit(t,{event:t,data:n}),a.emit(t,{event:t,data:n})})}var i=new google.ima.AdsRenderingSettings;i.restoreCustomPlaybackStateOnAdBreakComplete=!0;var r=-1,s={};Object.defineProperty(s,"currentTime",{get:function(){return e.adsManager&&(r!==e.adsManager.getRemainingTime()&&vpaid.emit(CONST.VPAID_EVENTS.AdRemainingTimeChange),r=e.adsManager.getRemainingTime()),vpaid.parameters.player.currentTime},set:_.noop()}),Object.defineProperty(s,"duration",{get:function(){return vpaid.parameters.player.duration},set:_.noop()}),e.adsManager=t.getAdsManager(s,i),scoringManager.trackMoatima(e),e.on("skip",function(e){n(e.event)});for(var d in CONST.IMA_EVENTS_MAP){var p=function(t){switch(utils.log("CMP IMA EVENT:",e.data.cmpId,t.type,t),t.type){case google.ima.AdEvent.Type.STARTED:try{e.imaAd=t.getAd(),vpaid.parameters.player.currentTime||(e.imaContainer.style.zIndex="1000")}catch(e){}n(CONST.IMA_EVENTS_MAP[t.type],t),e.imaAd.getCreativeId()!=CONST.BLANK_CREATIVE_ID&&(n(CONST.VAST_EVENTS_MAP.Impression,t),n(CONST.VAST_EVENTS_MAP.start,t)),!e.imaPaused&&a.autoPlayAdBreaks&&e.adsManager.resume(),utils.log("CustomPlayback: "+e.adsManager.isCustomPlaybackUsed()),utils.log("Duration: "+e.adsManager.getRemainingTime()),utils.log("RemainingTime: "+e.imaAd.getDuration());break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:e.adsManager.destroy(),UI.clear(),n(CONST.IMA_EVENTS_MAP[t.type],t,!0);break;case google.ima.AdEvent.Type.PAUSED:n(CONST.IMA_EVENTS_MAP[t.type],t),e.imaPaused||e.imaResumed||!vpaid.parameters.player.src||(e.imaResumed=!0,e.adsManager.resume());break;default:n(CONST.IMA_EVENTS_MAP[t.type],t)}};e.adsManager.addEventListener(d,p)}return e.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,o),n(CONST.VPAID_EVENTS.AdLoaded),Promise.resolve()}).then(function(){return n.promise}).then(function(){return a.startAdPromise}).then(function(){e.adDisplayContainer.initialize(),a.autoPlayAdBreaks&&(e.adsManager.init(vpaid.parameters.width,vpaid.parameters.height,google.ima.ViewMode.NORMAL),e.adsManager.setVolume(0),vpaid.emit(CONST.VPAID_EVENTS.AdVolumeChange,{data:0}),e.adsManager.start()),e.cmp_timeout&&e.cmp_timeout.start(),utils.log("Manager StartAd")}).then(function(){return t.promise}).then(function(){i()}).catch(o)}else s=e.loadAndParse().then(e.score.bind(e)).then(function(){return scoringManager.scoreSAS("o",e)}).then(e.logCampaignXMLReceived.bind(e)).then(e.handshake.bind(e)).then(e.subscribeAll.bind(e)).then(function(){e.on("*",function(t){if(!s.isCancelled())switch(utils.log("CMP",e.data.cmpId,"CampaignManager","EVENT:",t.event),t.event){case CONST.VPAID_EVENTS.AdError:return r();case CONST.VPAID_EVENTS.AdSkipped:return a.handleAdEnd(e,t);case CONST.VPAID_EVENTS.AdStopped:return a.AdStoppedHandler(e,t);case CONST.VPAID_EVENTS.AdVideoComplete:return a.handleAdEnd(e,t);case CONST.VPAID_EVENTS.AdVideoStart:if(e.selectedAd.selectedCreative.id==CONST.BLANK_CREATIVE_ID)break;default:a.emit(t.event,t.data)}})}).then(e.initAd.bind(e)).then(function(){return n.promise}).then(function(){return a.startAdPromise}).then(function(){e.cmp_timeout&&e.cmp_timeout.start(),utils.log("CMP",e.data.cmpId,"CampaignManager calling startAd"),e.vpaidCall(CONST.VPAID_METHODS.startAd)}).then(function(){return t.promise}).then(function(){i()}).catch(o)}.bind(this));return i},module.exports=CampaignsManager;
},{"./Campaign":6,"./queue":19,"./utils":39}],8:[function(require,module,exports){
var FlashDetect=new function(){var r=this;r.installed=!1,r.raw="",r.major=-1,r.minor=-1,r.revision=-1,r.revisionStr="";var n=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(r){return e(r)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(r){var i="6,0,21";try{r.AllowScriptAccess="always",i=e(r)}catch(r){}return i}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(r){return e(r)}}],e=function(r){var i=-1;try{i=r.GetVariable("$version")}catch(r){}return i},a=function(r){var i=-1;try{i=new ActiveXObject(r)}catch(r){i={activeXError:!0}}return i},t=function(r){var i=r.split(",");return{raw:r,major:parseInt(i[0].split(" ")[1],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),revisionStr:i[2]}},o=function(r){var i=r.split(/ +/),n=i[2].split(/\./),e=i[3];return{raw:r,major:parseInt(n[0],10),minor:parseInt(n[1],10),revisionStr:e,revision:s(e)}},s=function(i){return parseInt(i.replace(/[a-zA-Z]/g,""),10)||r.revision};r.versionAtLeast=function(n){var e=[r.major,r.minor,r.revision],a=Math.min(e.length,arguments.length);for(i=0;i<a;i++){if(e[i]>=arguments[i]){if(i+1<a&&e[i]==arguments[i])continue;return!0}return!1}},r.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var i="application/x-shockwave-flash",e=navigator.mimeTypes;if(e&&e[i]&&e[i].enabledPlugin&&e[i].enabledPlugin.description){var s=e[i].enabledPlugin.description,v=o(s);r.raw=v.raw,r.major=v.major,r.minor=v.minor,r.revisionStr=v.revisionStr,r.revision=v.revision,r.installed=!0}}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var s=-1,c=0;c<n.length&&-1==s;c++){var l=a(n[c].name);if(!l.activeXError&&(r.installed=!0,-1!=(s=n[c].version(l)))){var v=t(s);r.raw=v.raw,r.major=v.major,r.minor=v.minor,r.revision=v.revision,r.revisionStr=v.revisionStr}}}()};FlashDetect.JS_RELEASE="1.0.4",module.exports=FlashDetect;
},{}],9:[function(require,module,exports){
function Ad(t){t=t||{},this.VPAID_TRACKING=t.tracking||{},this.isCheckAccessControl=t.isCheckAccessControl}function makeArray(t){return void 0===t?[]:_.isArray(t)?t:[t]}function VPAIDFlashAd(){}function isInFif(){try{return!!top.location.href}catch(t){return!1}}function getWindow(){try{if(top.location.href)return window.top}catch(t){return window}}function VPAIDAd(){}function Creative(t){if(this.xml=_.get(t,["Linear"]),!this.xml)throw new Error("Supported only linear creatives");this.isLinear=!0,this.id=_.get(t,["_attributes","id"],""),this.skipOffset=parseTime(_.get(this.xml,["_attributes","skipoffset"]))}function parseTime(t){if(!t)return 5;if(-1!=t.indexOf("%"))return console.warn("do not support % skip offset yet"),null;var e=t.split(":");return 1*e[0]*3600+1*e[1]*60+1*e[2]}var FlashDetect=require("./FlashDetect");Ad.prototype.defineRoot=function(t){var e=_.get(t,["InLine"]),i=_.get(t,["Wrapper"]);this.isInLine=this.isWrapper=!1,e&&(this.isInLine=!0),i&&(this.isWrapper=!0),this.tree=e||i||{},this.tree._adAttributes=_.get(t,["_attributes"])},Ad.prototype.getVpaidInterface=function(t){return new Promise(function(e){e(this.getVPAIDAd(t.skipButtonEnabled))}.bind(this))},Ad.prototype.setTracking=function(t,e){t=CONST.VAST_EVENTS_MAP[t]||t,this.VPAID_TRACKING[t]=this.VPAID_TRACKING[t]||[],this.VPAID_TRACKING[t].push(e)},Ad.prototype.setAdTracking=function(t){_.each(this.getTopLevelTracking(t),function(e){this.setTracking(t,e)}.bind(this))},Ad.prototype.getTopLevelTracking=function(t){return _.map(makeArray(_.get(this.tree,[t])),function(t){return t._cdata||t._text})},Ad.prototype.getRedirectURI=function(){return _.get(this.tree,["VASTAdTagURI","_cdata"],_.get(this.tree,["VASTAdTagURI","_text"],null))},Ad.prototype.getAdSystem=function(){return _.get(this.tree,["AdSystem","_cdata"],_.get(this.tree,["AdSystem","_text"],""))},Ad.prototype.getAnyLinearCreative=function(){return _.find(this.creatives,function(t){return t.isLinear})},Ad.prototype.getVASTCreative=function(){return _.find(this.creatives,function(t){return t.getVASTMediaFile(0),!!t.okMediaFiles[0]})},Ad.prototype.getJsVpaidCreative=function(){return _.find(this.creatives,function(t){return!!t.getJsVpaidMediaFile()})},Ad.prototype.getFlashVpaidCreative=function(){return _.find(this.creatives,function(t){return!!t.getFlashVpaidMediaFile()})},Ad.prototype.destroy=function(){},Ad.prototype.getVPAIDAd=function(t){var e,i,n=(window.vpaid,{}),r=this,a=utils.getCallLimitedFunc(function(t){var e=r.selectedCreative.getVideoClicks(),i=_.get(e,["ClickThrough","_cdata"],_.get(e,["ClickThrough","_text"]));i&&(n.emit(CONST.VPAID_EVENTS.AdClickThru),window.open(i,"_blank"))},200);return n.adSkippableState=!1,n.initAd=function(t,a,o,s,d,c){n.stopped=!1,e=c.videoSlot,i=c.slot,utils.once(e,"loadedmetadata",function(){n.emit(CONST.VPAID_EVENTS.AdLoaded)}),utils.once(e,"error",function(t){if(e.src){var i=r.selectedCreative.getVASTMediaFile();i?(e.src=i._cdata||i._text,e.load()):n.emit(CONST.VPAID_EVENTS.AdError,"All media files failed")}});var u=r.selectedCreative.getVASTMediaFile(0);e.src=u._cdata||u._text,e.load()},n.handshakeVersion=function(){return"2.0"},n.startAd=function(){function o(){if(!e.seeking){d=e.currentTime,null!==r.selectedCreative.skipOffset&&d>=r.selectedCreative.skipOffset&&!t&&(n.adSkippableState=!0,r.selectedCreative.skipOffset=null,n.emit(CONST.VPAID_EVENTS.AdSkippableStateChange)),n.emit(CONST.VPAID_EVENTS.AdRemainingTimeChange);var i=Math.round(e.currentTime/e.duration*100);i>25&&0==s?(s++,n.emit(CONST.VPAID_EVENTS.AdVideoFirstQuartile)):i>50&&1==s?(s++,n.emit(CONST.VPAID_EVENTS.AdVideoMidpoint)):i>75&&2==s&&(s++,n.emit(CONST.VPAID_EVENTS.AdVideoThirdQuartile))}}var s=0;utils.addEvent(i,"click",a),utils.addEvent(e,"click",a),utils.addEvent(e,"durationchange",function(){n.emit(CONST.VPAID_EVENTS.AdDurationChange)}),utils.addEvent(e,"ended",function(){n.emit(CONST.VPAID_EVENTS.AdVideoComplete)});var d=0;utils.once(e,"playing",function(){n.emit(CONST.VPAID_EVENTS.AdStarted),n.emit(CONST.VPAID_EVENTS.AdVideoStart),n.emit(CONST.VPAID_EVENTS.AdImpression),n.emit(CONST.VPAID_EVENTS.AdSkippableStateChange)}),utils.addEvent(e,"seeking",function(){var t=e.currentTime-d;Math.abs(t)>.01&&(e.currentTime=d)}),utils.addEvent(e,"timeupdate",o),(e.play()||Promise.resolve()).catch(function(){e.muted=!0,n.emit(CONST.VPAID_EVENTS.AdVolumeChange),e.play()})},n.stopAd=function(t){e.pause(),e.src="",t&&n.emit(CONST.VPAID_EVENTS.AdStopped),n.stopped=!0},n.skipAd=function(t){e.pause(),e.src="",n.emit(CONST.VPAID_EVENTS.AdSkipped),n.stopped=!0},n.resizeAd=function(t,i,r){t&&(e.style.width=t+"px"),i&&(e.style.height=i+"px"),t&&i&&n.emit(CONST.VPAID_EVENTS.AdSizeChange)},n.pauseAd=function(){e.pause(),n.emit(CONST.VPAID_EVENTS.AdPaused)},n.resumeAd=function(){e.play(),n.emit(CONST.VPAID_EVENTS.AdPlaying)},n.expandAd=_.noop,n.collapseAd=_.noop,n.getAdIcons=_.noop,n.getAdDuration=function(){return e.duration},n.getAdExpanded=function(){return!0},n.getAdHeight=function(){return n.parameters.height},n.getAdWidth=function(){return n.parameters.width},n.getAdLinear=function(){return!0},n.getAdRemainingTime=function(){return e.duration-e.currentTime},n.getAdSkippableState=function(){return n.adSkippableState},n.getAdVolume=function(){return e.volume},n.setAdVolume=function(t){return e.volume=t,n.emit(CONST.VPAID_EVENTS.AdVolumeChange),t},utils.implementPubSub(n,function(t,e){return!(!CONST.VPAID_EVENTS[t]||n.stopped)}),n},Ad.prototype.getRevShare=function(){var t=null,e=_.get(this.tree,["Pricing"]),i=this.selectedCreative.getParameters();if(i)try{t=1*i.match(/price="([\d\.]+)"/i)[1]}catch(t){}var n=_.get(this.tree,["Extensions","Extension"]),r=_.find(n,function(t){var e=_.get(t,["_attributes","type"]);return"LR-Pricing"==e||"Videe-CPM"==e});return!e&&r&&(e=_.get(r,["Price"])),e&&"CPM"==_.get(e,["_attributes","model"])&&(t=parseFloat(e._cdata||e._text)),t},Ad.prototype.getParameters=function(){return this.selectedCreative.getParameters()},Ad.prototype.parseCreatives=function(){function t(){var t=_.get(this.tree,["Creatives","Creative"]);return _.filter(_.map(makeArray(t),function(t){try{return new Creative(t)}catch(t){return utils.log(t.message||t),null}}),function(t){return!!t})}this.creatives=t.call(this)},Ad.prototype.setCreativeClickTracking=function(t){t&&_.each(makeArray(_.get(t.getVideoClicks(),["ClickTracking"])),function(t){this.setTracking("AdClickThru",t._cdata||t._text)}.bind(this))},Ad.prototype.setCreativeTracking=function(t){t&&_.each(t.getTrackingEvents(),function(t){this.setTracking(_.get(t,["_attributes","event"]),_.get(t,["_cdata"],_.get(t,["_text"])))}.bind(this))},Ad.prototype.pickCreative=function(){return new Promise(function(t,e){var i=this.getJsVpaidCreative(),n=this.getVASTCreative(),r=this.getFlashVpaidCreative();if(i)this.selectedCreative=i,this.isVpaid=!0,_.extend(this,VPAIDAd.prototype);else if(r&&FlashDetect.versionAtLeast(10,3,0))this.selectedCreative=r,this.isVpaid=!0,this.isFlash=!0,_.extend(this,VPAIDFlashAd.prototype);else{if(!n)return t(this);this.selectedCreative=n,this.isVast=!0}i&&(this.creativeType="vpaidjs"),r&&(this.creativeType=i?"combined":"vpaidflash"),n&&(this.creativeType="vast"),this.setCreativeTracking(this.selectedCreative),this.setCreativeClickTracking(this.selectedCreative),t(this)}.bind(this))},Ad.prototype.getDuration=function(){return this.selectedCreative?this.selectedCreative.getDuration():0},Ad.prototype.logVASTError=function(t){var e=this.VPAID_TRACKING.AdError,i=CONST.VAST_ERROR[t];e&&i&&_.map(e,function(t){utils.trackVastEvent(t.replace(/\[ERRORCODE\]/g,i))})},VPAIDFlashAd.prototype.destroy=function(){try{this.swfObj&&this.swfObj.parentElement&&this.swfObj.parentElement.removeChild(this.swfObj)}catch(t){}},VPAIDFlashAd.prototype.createContainer=function(t){var e=this,i=getWindow();return function(i){return new Promise(function(n,r){utils.loadScript(vpaid.settings.endpoints.cdn+"static/swfobject.js",i.document.body,!0).then(function(){setTimeout(function(){var r=i.document.createElement("div");e.containerID="flashContent"+Date.now(),vpaid._flashContainerId=e.containerID,r.id=e.containerID;var a=t||i.document.body;a.appendChild(r);var o=a.ownerDocument;e.swfWindow=o.defaultView||o.parentWindow;var s="___ev"+Date.now()+"___";e.swfWindow[s]=function(){setTimeout(function(){n(a.querySelector("object"))},1)};var d={onReady:'function(){window["'+s+'"]();}'},c={quality:"high",WMODE:"transparent",allowscriptaccess:"always",allowfullscreen:"true"},u={id:e.containerID,name:"vpaid",align:"middle",style:"display:block;position:absolute;top:0;right:0px;width:1px;z-index:1;"};i.swfobject.embedSWF(vpaid.settings.endpoints.cdn+"static/vpaid-ssp-vast.swf",r,"100%","100%","10.3.0",null,d,c,u)},50)})})}(i)};var getCoords=function(t,e,i){if(!e){var n=t.getBoundingClientRect();e={top:n.top,left:n.left}}try{if(isInFif()&&i.parent!=i)for(var r=i.parent.document.getElementsByTagName("iframe"),a=0;a<r.length;a++)if(r[a].contentWindow===i){var o=r[a].getBoundingClientRect();return e.top+=o.top,e.left+=o.left,getCoords(r[a],e,i.parent)}}catch(t){utils.log("cant do iframe coords search",t)}return e.top+=i.pageYOffset,e.left+=i.pageXOffset,e};VPAIDFlashAd.prototype.getVpaidInterface=function(t){var e=this,i=window,n=vpaid.parameters.envParameters.flashSlot;getWindow();return function(r){return e.createContainer(n).then(function(n){e.swfObj=n;var r={},a="___e"+Date.now()+"___";e.swfWindow[a]={};var o=_.extend({},vpaid.rawConfigData);return o.auctions=[t],o.silentMode=!0,r.initAd=function(t,e,r,a,s,d){if(d.flashSlot)n.style.top="0px",n.style.left="0px",n.style.height=e+"px",n.style.width=t+"px";else{var c=d.slot||d.videoSlot;c&&setTimeout(function(){var r=getCoords(c,null,i);n.style.top=r.top+"px",n.style.left=r.left+"px",n.style.height=e+"px",n.style.width=t+"px"},3e3)}n.videe_initAd(t,e,r,a,JSON.stringify(o))},r.subscribe=function(t,i){utils.log("Calling SWF subscribe",i),e.swfWindow[a][i]=function(){utils.log("Exec SWF subscription",i),t.apply(this,arguments),"AdStopped"!=i&&"AdError"!=i||e.destroy()},n.videe_addVpaidEventListener(i,"window."+a+"."+i)},_.each(CONST.VPAID_METHODS_ARR,function(t){if(t==CONST.VPAID_METHODS.getFlashContainerId)return void(r[t]=function(){return vpaid._flashContainerId});r[t]||(r[t]=function(){utils.log("Calling SWF method",t);try{return n["videe_"+t].apply(n,arguments)}catch(t){}})}),r})}()},VPAIDAd.prototype.destroy=function(){this.fif&&this.fif.parentElement&&this.fif.parentElement.removeChild(this.fif)},VPAIDAd.prototype.createContainer=function(){var t=this;return new Promise(function(e,i){var n=document.createElement("iframe");n.style.border="0px",n.style.opacity="1",n.style.overflow="hidden",n.style.display="block",n.style.position="absolute",n.style.padding="0px",n.style.margin="0px",n.style.top="0px",n.style.left="0px",n.style.width="100%",n.style.height="100%";var r="about:blank",a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(n.src=r,t.fif=n,n.onload=function(){var r=document.createElement("div");r.style.width="100%",r.style.height="100%",r.id="slot",n.contentDocument.body.appendChild(r),vpaid.parameters.envParameters.innerSlot=r;var a=document.createElement("script");a.onload=function(){e()},a.onerror=function(){i(new Error(CONST.CAMPAIGN_ERRORS.vpaid_load_error))};var o=t.selectedCreative.getJsVpaidMediaFile();a.src=o._cdata||o._text,t.fif.contentDocument.body.appendChild(a)},n.onerror=function(t){if(a&&location.href==r)return n.onload();utils.log("cant create FIF",t,t.message),i(new Error(CONST.CAMPAIGN_ERRORS.iframe_init_error))},document.body||document.children[0].appendChild(document.createElement("body")),isInFif()&&"Exponential Ads"==t.getAdSystem()){for(var o=parent.document.getElementsByTagName("iframe"),s=0;s<o.length;s++)if(o[s].contentWindow.document===document){vpaid.parameters.envParameters.slot=o[s].parentElement;for(var d in o[s].style)n.style[d]=o[s].style[d];n.width=o[s].width,n.height=o[s].height,o[s].style.display="none";break}}else vpaid.parameters.envParameters.slot||(vpaid.parameters.envParameters.slot=vpaid.parameters.envParameters.videoSlot.parentElement);return vpaid.parameters.envParameters.slot.appendChild(n),n})},VPAIDAd.prototype.getVpaidInterface=function(t){var e=this;return this.createContainer().then(function(){return e.fif.contentWindow.getVPAIDAd(t.skipButtonEnabled)})},Creative.prototype.getParameters=function(){var t=_.get(this.xml,["AdParameters","_cdata"],_.get(this.xml,["AdParameters","_text"]));return _.isArray(t)?t.join(""):t},Creative.prototype.getMediaFiles=function(){return makeArray(_.get(this.xml,["MediaFiles","MediaFile"]))},Creative.prototype.getTrackingEvents=function(){return makeArray(_.get(this.xml,["TrackingEvents","Tracking"]))},Creative.prototype.getVideoClicks=function(){return _.get(this.xml,["VideoClicks"])},Creative.prototype.getJsVpaidMediaFile=function(){return _.find(this.getMediaFiles(),function(t){return"vpaid"==_.get(t,["_attributes","apiFramework"],"").toLowerCase()&&-1!==_.get(t,["_attributes","type"],"").toLowerCase().indexOf("javascript")})},Creative.prototype.getFlashVpaidMediaFile=function(){return _.find(this.getMediaFiles(),function(t){return"vpaid"==_.get(t,["_attributes","apiFramework"],"").toLowerCase()&&(-1!==_.get(t,["_attributes","type"],"").toLowerCase().indexOf("flash")||-1!==_.get(t,["_attributes","type"],"").toLowerCase().indexOf("x-flv"))})},Creative.prototype.getVASTMediaFile=function(t){function e(t){return""!==vpaid.parameters.envParameters.videoSlot.canPlayType(t)}return this.okMediaFiles?this.okMediaIndex++:(this.okMediaIndex=0,this.okMediaFiles=_.filter(this.getMediaFiles(),function(t){var i=_.get(t,["_attributes","type"],"");return-1!==i.toLowerCase().indexOf("video")&&e(i)})||[]),void 0!==t&&(this.okMediaIndex=t),this.okMediaFiles[this.okMediaIndex]},Creative.prototype.getDuration=function(){var t=_.get(this.xml,["Duration","_text"],"00:00:00");return utils.convertTimeStrToSeconds(t)},module.exports=Ad;
},{"./FlashDetect":8}],10:[function(require,module,exports){
var Ad=require("./ad"),AdsLoader=function(){this.redirectsCount=0};AdsLoader.prototype.getAdXmlDom=function(e){try{return(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Ad")}catch(e){throw new Error(CONST.CAMPAIGN_ERRORS.xml_unknown)}},AdsLoader.prototype.parse=function(e){return utils.xmlToJson(e)},AdsLoader.prototype.analyseSequence=function(e){var r=[],t=[],n={};return _.each(e,function(e){_.get(e.tree,["_adAttributes","sequence"])?r.push(e):t.push(e)}),t=_.filter(t,function(e){return!!e.selectedCreative}),t.length&&(n.buffet=t),r.length&&(r=r.sort(function(e,r){return _.get(e.tree,["_adAttributes","sequence"])-_.get(r.tree,["_adAttributes","sequence"])}),n.pod=r),n},AdsLoader.prototype.load=function(e,r,t,n){var o=this;if(o.redirectsCount>7)throw r&&r.logVASTError("WRAPPER_LIMIT_REACHED"),new Error(CONST.CAMPAIGN_ERRORS.xml_max_redirects);return function(){return n?Promise.resolve(n):utils.ajaxLoad(e,null,5e3,t)}().then(function(e){try{var n=o.getAdXmlDom(e)}catch(e){throw r&&r.logVASTError("VAST_PARSING_ERROR"),e}if(!n||!n.length)throw r&&r.logVASTError("WRAPPER_NO_ADS"),new Error(CONST.CAMPAIGN_ERRORS.xml_empty);var a=0,i=_.map(n,function(e){if(a++&&e.attributes&&!e.attributes.sequence)return Promise.resolve();var n=new Ad({tracking:JSON.parse(JSON.stringify(_.get(r,["VPAID_TRACKING"],{}))),isCheckAccessControl:t}),i=o.parse(e);if(n.defineRoot(i),n.setAdTracking("Impression"),n.setAdTracking("Error"),n.parseCreatives(),n.isWrapper){var s=n.getAnyLinearCreative();return n.setCreativeTracking(s),n.setCreativeClickTracking(s),o.load(n.getRedirectURI(),n,t)}return n.pickCreative()});return Promise.all(i).catch(function(e){throw r&&r.logVASTError("UNDEFINED_ERROR"),e})}).then(function(e){return e[0]instanceof Ad?o.analyseSequence(e):e[0]})},module.exports=AdsLoader;
},{"./ad":9}],11:[function(require,module,exports){
var CAMPAIGN_MANAGER_EVENTS=["GLOBAL_ERROR"],NEWSTAT_TRACKING_URLS={VPAIDXMLRequested:"/request/row",VPAIDConfigReceived:"/request/data",VPAIDFailed:"/request/error",CampaignXMLRequested:"/campaign/request",CampaignXMLReceived:"/campaign/received",CampaignError:"/campaign/error",PlayerEvent:"/vpaid-event",ScoringRequest:"/scoring/request",ScoringGood:"/scoring/good",ScoringBad:"/scoring/bad",ScoringTimeout:"/scoring/timeout",ScoringNoAccess:"/scoring/no_access",MARKUP:"/log/adm"},VAST_EVENTS_MAP={Impression:"AdImpression",Error:"AdError",start:"AdVideoStart",firstQuartile:"AdVideoFirstQuartile",midpoint:"AdVideoMidpoint",thirdQuartile:"AdVideoThirdQuartile",complete:"AdVideoComplete",creativeView:"AdStarted",pause:"AdPaused",resume:"AdPlaying",skip:"AdSkipped",collapse:"AdUserMinimize",mute:"AdVolumeChange",unmute:"AdVolumeChange",error:"AdError",acceptInvitationLinear:"AdUserAcceptInvitation",closeLinear:"AdUserClose"},IMA_EVENTS_MAP={allAdsCompleted:"AdStopped",click:"AdClickThru",complete:"AdVideoComplete",durationChange:"AdDurationChange",expandedChanged:"AdExpandedChange",firstquartile:"AdVideoFirstQuartile",interaction:"AdInteraction",linearChanged:"AdLinearChange",midpoint:"AdVideoMidpoint",pause:"AdPaused",resume:"AdPlaying",skippableStateChanged:"AdSkippableStateChange",skip:"AdSkipped",start:"AdStarted",thirdquartile:"AdVideoThirdQuartile",userClose:"AdUserClose",volumeChange:"AdVolumeChange",mute:"AdVolumeChange"},IMA_METHODS_MAP={stopAd:"stop",skipAd:"skip",resizeAd:"resize",pauseAd:"pause",resumeAd:"resume",expandAd:"expand",collapseAd:"collapse",setAdVolume:"setVolume",getAdVolume:"getVolume",getAdRemainingTime:"getRemainingTime",getAdSkippableState:"getAdSkippableState"},IMA_ERRORS_MAP={1012:100,1009:101,301:102,302:103,1010:110,101:110,900:199,403:111},CAMPAIGN={xml_network_error:100,xml_empty:101,xml_timeout:102,xml_max_redirects:103,scoring_error:104,campaign_timeout:105,vpaid_load_error:107,vpaid_ad_error:108,vpaid_exception:109,xml_unknown:110,xml_unknown_media_file:111,iframe_init_error:112,spotx_wo_error:114,UNKNOWN:199},GLOBAL={AD_PARAMS_ERROR:100,CONFIG_PARSE_ERROR:200,TIMEOUT:201,CONFIG_LOAD_ERROR:202},REQUEST_ERRORS={NO_ADS:200,TIMEOUT:201,CONFIG_LOAD_ERROR:202,CYCLIC_LOADING:203,ALL_CAMPAIGNS_FILTERED:206,PARSE_ERROR:207,ALL_CAMPAIGNS_ERRORED:208,UNKNOWN_ERROR:209},VPAID_EVENT_CODES={AdDurationChange:69,AdExpandedChange:64,AdLoaded:80,AdPaused:60,AdPlaying:62,AdSkipped:66,AdStarted:52,AdStopped:70,AdClickThru:71,AdUserClose:67,AdVideoComplete:57,AdVideoFirstQuartile:55,AdVideoMidpoint:54,AdVideoStart:53,AdVideoThirdQuartile:56,AdVolumeChange:68,WindowClose:90},VPAID_EVENTS_ARR=["AdClickThru","AdDurationChange","AdError","AdExpandedChange","AdImpression","AdInteraction","AdLinearChange","AdLoaded","AdLog","AdPaused","AdPlaying","AdRemainingTimeChange","AdSizeChange","AdSkipped","AdStarted","AdStopped","AdSkippableStateChange","AdUserAcceptInvitation","AdUserClose","AdUserMinimize","AdVideoComplete","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoStart","AdVideoThirdQuartile","AdVolumeChange","Ping"],CAMPAIGN_STATUS={READY:1,XML_LOADED:10,SCORED:20,VPAID_LOADED:30,HANDSHAKED:40,AD_LOADED:50,AD_STARTED:60},vpaidMethods=["getFlashContainerId","handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe","getAdIcons","getAdDuration","getAdExpanded","setAdVolume","getAdVolume","getAdHeight","getAdWidth","getAdLinear","getAdRemainingTime","getAdSkippableState"],MOAT_EVENTS=["AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdVolumeChange"],ENV_MAP={desktop:"Desktop_Video",mobile_web:"Mobile_Web_Video",mobile_app:"Mobile_InApp_Video"},EVENTS_MAX_FREQUENCIES={AdDurationChange:1e3,AdVolumeChange:1e3,AdSizeChange:1e3,AdRemainingTimeChange:1e3},VAST_ERROR={VAST_PARSING_ERROR:100,VAST_SCHEMA_VALIDATION_ERROR:101,WRAPPER_LIMIT_REACHED:302,WRAPPER_NO_ADS:303,UNDEFINED_ERROR:900,GENERAL_VPAID_ERROR:901};module.exports={IMA_AID_LIST:[59965,59990,60011,60012,87847,87912,313355,313357,313359,313360,313377,313378,313465,313466],BLANK_CREATIVE_ID:"117108883267",SCORING_TIMEOUT:3e3,DEFAULT_SKIP_OFFSET:5,CAMPAIGN_ERRORS:CAMPAIGN,CAMPAIGN_STATUS:CAMPAIGN_STATUS,ERROR_GLOBAL:GLOBAL,VPAID_EVENTS:_.zipObject(VPAID_EVENTS_ARR,VPAID_EVENTS_ARR),VPAID_METHODS:_.zipObject(vpaidMethods,vpaidMethods),CAMPAIGN_MANAGER_EVENTS:_.zipObject(CAMPAIGN_MANAGER_EVENTS,CAMPAIGN_MANAGER_EVENTS),VPAID_METHODS_ARR:vpaidMethods,VAST_EVENTS_MAP:VAST_EVENTS_MAP,IMA_EVENTS_MAP:IMA_EVENTS_MAP,IMA_METHODS_MAP:IMA_METHODS_MAP,IMA_ERRORS_MAP:IMA_ERRORS_MAP,NEWSTAT_TRACKING_URLS:NEWSTAT_TRACKING_URLS,VPAID_EVENT_CODES:VPAID_EVENT_CODES,EVENTS_MAX_FREQUENCIES:EVENTS_MAX_FREQUENCIES,ENV_MAP:ENV_MAP,MOAT_EVENTS:_.zipObject(MOAT_EVENTS,MOAT_EVENTS),REQUEST_ERRORS:REQUEST_ERRORS,VAST_ERROR:VAST_ERROR};
},{}],12:[function(require,module,exports){
function CookieSync(){this.params={t:"a",ep:23716}}CookieSync.prototype.sync=function(t,e){if(this.syncAllowed(e)){var o=this,n=utils.getUrl("//sync.vertamedia.com/get-cookie",this.params);utils.loadJson(n).then(function(e){var n="https://p.adsymptotic.com/d/px?_pid=13719&_psign=800df361f9aac5d26f40f0d3d1dc74fb&_pu="+encodeURIComponent(t)+"&_puuid="+e.vmuid+"&_rand="+utils.now().toString()+Math.floor(99999*Math.random())+"&_redirect="+encodeURIComponent("https://sync.vertamedia.com/csync/?t="+o.params.t+"&ep="+o.params.ep+"&extuid=${UUID}"),i=document.createElement("img");i.src=n,i.alt="",i.style="border-style:none;",i.width=1,i.height=1,document.getElementsByTagName("body")[0].appendChild(i)})}},CookieSync.prototype.getCookies=function(t){_.each(t,function(t){newStat.sendCookieSyncUrls(t)})},CookieSync.prototype.syncAllowed=function(t){var e=this,o=!1;return _.each(t,function(t){t.advId==e.params.ep&&(o=!0)}),o},module.exports=CookieSync;
},{}],13:[function(require,module,exports){
module.exports={log:function(o){try{if(window.top&&window.top.postMessage){var t=_.extend({},o,{from:"verta"});window.top.postMessage(t,"*")}}catch(o){}}};
},{}],14:[function(require,module,exports){
(function (global){
global.vpaid={};var VERSION="2.0",UnitVersion="2.3.190";global.Promise=require("node-sk-promise");var url_parser=require("./url.js");global._=require("./lodashCustom");var locationProvider=require("./locationProvider");global.vertadebug=require("./debugger"),global.locationInfo=locationProvider(),global.oldStat=new(require("./oldStat")),global.newStat=new(require("./newStat")),global.CONST=require("./const"),global.utils=require("./utils");var uiManager=require("./ui"),cookieSync=new(require("./cookieSync"));global.Defer=utils.Defer,global.scoringManager=null;var AdsLoader=require("./adsLoader");utils.log(JSON.stringify(global.locationInfo,null,"  "));var CampaignsManager=require("./CampaignsManager"),vpaidMethods=CONST.VPAID_METHODS_ARR,vpaidFailed=!1,handleCriticalError=function(a){vpaidFailed||(vpaidFailed=!0,Promise.all([newStat.finalize(),oldStat.finalize()]).then(function(){utils.log("Emitting AdError",a),vpaid.emit(CONST.VPAID_EVENTS.AdError,a),vpaid.campaignsManager&&vpaid.campaignsManager.remove()}))};vpaid.parameters={},vpaid.campaigns=vpaid.checkVPAIDInterface=function(a){return!(!a||"function"!=typeof a.handshakeVersion||"function"!=typeof a.initAd||"function"!=typeof a.startAd||"function"!=typeof a.stopAd||"function"!=typeof a.skipAd||"function"!=typeof a.resizeAd||"function"!=typeof a.pauseAd||"function"!=typeof a.resumeAd||"function"!=typeof a.expandAd||"function"!=typeof a.collapseAd||"function"!=typeof a.subscribe||"function"!=typeof a.unsubscribe)},vpaid.handshakeVersion=function(a){return VERSION},vpaid.initAd=function(a,e,i,t,n,r){function d(a){var e;"NO_ADS"!==a&&(e="string"==typeof a&&void 0!==CONST.REQUEST_ERRORS[a]?CONST.REQUEST_ERRORS[a]:CONST.REQUEST_ERRORS.UNKNOWN_ERROR,newStat.log({event:"VPAIDFailed",type:e})),handleCriticalError(a)}if(n.AdParameters&&(n=n.AdParameters),"string"==typeof n&&(n=JSON.parse(n)),!n.configUrl&&!n.auctions)return handleCriticalError(CONST.ERROR_GLOBAL.AD_PARAMS_ERROR);var o=utils.getDefDomain(n.configUrl);vpaid.parameters.base_domain=o||"vertamedia.com",vpaid.parameters.base_domain_static=o||"unocdn.com",newStat.setUrls(["//aux-log."+vpaid.parameters.base_domain]),n.silentMode&&(newStat.disable(),oldStat.disable());var s=r.videoSlotCanAutoPlay||!1,p=r.videoSlot;if(!p){if(utils.log("WARNING: videoSlot is undefined!"),!r.slot)return handleCriticalError(new Error(CONST.ERROR_GLOBAL.AD_PARAMS_ERROR));p=window.document.createElement("video"),r.videoSlot=p,r.slot.appendChild(p)}if(n.configUrl){var l=url_parser.getQuery(n.configUrl);vpaid.parameters.aid=l.aid,vpaid.parameters.sid=l.sid}else vpaid.parameters.aid=n.parameters.aid,vpaid.parameters.sid=n.parameters.sid;oldStat.addConfig({v:UnitVersion,t:"js",aid:vpaid.parameters.aid,sid:vpaid.parameters.sid}),vpaid.parameters.container=r.slot||p,vpaid.parameters.player=p,vpaid.parameters.width=parseInt(a||p.clientWidth||p.width)||640,vpaid.parameters.height=parseInt(e||p.clientHeight||p.height)||480,vpaid.parameters.cb=1e3*Math.random()+"."+(new Date).getTime(),vpaid.parameters.viewMode=i,vpaid.parameters.bitrate=t,vpaid.parameters.adParameters=n,vpaid.parameters.envParameters=r,vpaid.parameters.app_type="js",vpaid.parameters.envParameters.flashSlot=r.flashSlot||r.slot,vpaid.parameters.scheme=utils.getScheme(),vpaid.parameters.placementId=utils.getPlacementId(vpaid.parameters.player,vpaid.parameters.container),vpaid.parameters.csubid=utils.getCsubid(vpaid.parameters.aid),global.UI=new uiManager(r.slot,p),newStat.addConfig({v:UnitVersion,t:"js",aid:vpaid.parameters.aid,sid:vpaid.parameters.sid,width:vpaid.parameters.width,height:vpaid.parameters.height}),function(){if(window.vm_aid=vpaid.parameters.aid,n.configUrl){vpaid.parameters.unitVersion=UnitVersion;var a=utils.getAChain(vpaid.parameters.aid),e=a?{aChain:a}:{};e.vpaid_type=2;var i=utils.prepareInternalUrl(n.configUrl,vpaid.parameters);return new Promise(function(a,t){return utils.ajaxLoad(i,e).then(a).catch(function(a){t("CONFIG_LOAD_ERROR")})}).then(function(a){try{return JSON.parse(a)}catch(a){throw"PARSE_ERROR"}})}return Promise.resolve(n)}().then(function(a){if(utils.log("config loaded"),a&&a.parameters&&a.parameters.cookiesync&&cookieSync.getCookies(a.parameters.cookiesync),a&&(!a.parameters||!a.auctions||0===a.auctions.length))throw"NO_ADS";vpaid.rawConfigData=a;try{vpaid.settings=vpaid.rawConfigData.parameters,vpaid.parameters.uip=vpaid.settings.uip,vpaid.parameters.adid=vpaid.settings.adId||"",vpaid.parameters.useIma=vpaid.settings.useIma,vpaid.settings.threads=1,global.locationInfo=locationProvider(vpaid.settings.allowIframe),"mobile_web"==vpaid.settings.environment&&(vpaid.parameters.player.setAttribute("muted",""),vpaid.parameters.player.muted=!0);var e=vpaid.settings.endpoints=vpaid.settings.endpoints||{};e.vms2s=e.vms2s||"//scoring."+vpaid.parameters.base_domain+"/",e.forensiq=e.forensiq||"//scoring."+vpaid.parameters.base_domain+"/",e.cdn=e.cdn||"//static."+vpaid.parameters.base_domain_static+"/",e.firewall=e.firewall||"//firewall."+vpaid.parameters.base_domain+"/",e["aux-log"]=e["aux-log"]||"//aux-log."+vpaid.parameters.base_domain+"/",vpaid.settings.stat_domains=vpaid.settings.stat_domains||[],newStat.addConfig({domain:locationInfo.final_domain,adId:vpaid.settings.adId,env:vpaid.settings.environment}),oldStat.addConfig({traking:vpaid.settings.tracking}),vpaid.settings.stat_domains.length?newStat.setUrls(_.map(vpaid.settings.stat_domains,function(a){return"//"+a})):newStat.setUrls([e["aux-log"]]),scoringManager=new(require("./scoring/ScoringManager"))({aid:vpaid.settings.aid,sid:vpaid.settings.sid,domain:locationInfo.final_domain,page_url:locationInfo.final_page_url,ua:locationInfo.ua,width:vpaid.parameters.width,height:vpaid.parameters.height,pubId:vpaid.settings.pubId,adId:vpaid.parameters.adid,uip:vpaid.settings.uip,useIma:vpaid.settings.useIma,placementId:vpaid.parameters.placementId,env:vpaid.settings.environment}),scoringManager.scoreSAS("o",vpaid.settings)}catch(a){throw"UNKNOWN_ERROR"}return newStat.log({event:"VPAIDXMLRequested"})}).then(function(){utils.log("row sent"),newStat.log({event:"VPAIDConfigReceived"}),utils.log("READY, EMIT"),cookieSync.sync(locationInfo.final_page_url,vpaid.rawConfigData.auctions);var a=[CONST.VPAID_EVENTS.AdImpression,CONST.VPAID_EVENTS.AdLoaded,CONST.VPAID_EVENTS.AdStarted],e=_.difference(_.keys(CONST.VPAID_EVENTS),a.concat([CONST.VPAID_EVENTS.AdError]));vpaid.campaignsManager=new CampaignsManager(vpaid.rawConfigData.auctions,vpaid),a.forEach(function(a){vpaid.campaignsManager.once(a,function(e){vpaid.emit(a,e),utils.log("proxied events",a,e)})}),e.forEach(function(a){vpaid.campaignsManager.on(a,function(e){vpaid.emit(a,e),utils.log("proxied events",a,e)})}),vpaid.campaignsManager.on(CONST.CAMPAIGN_MANAGER_EVENTS.GLOBAL_ERROR,function(a){d(a),vpaid.campaignsManager.remove()}),vpaid.campaignsManager.start(vpaid.settings.threads||1)}).catch(d),utils.log("AUTOPLAY:",s),utils.log("videoSlot:",p)},vpaid.startAd=function(){utils.log("AD START called")},vpaid.stopAd=function(){vpaid.campaignsManager.stop()},vpaid.skipAd=function(){},vpaid.resizeAd=function(){},vpaid.pauseAd=function(){},vpaid.resumeAd=function(){},vpaid.expandAd=function(){},vpaid.collapseAd=function(){},vpaid.getAdIcons=function(){return{}},vpaid.getAdDuration=function(){return 30},vpaid.getAdExpanded=function(){return!1},vpaid.getAdHeight=function(){return 480},vpaid.getAdWidth=function(){return 640},vpaid.getAdLinear=function(){return!0},vpaid.getAdRemainingTime=function(){return 30},vpaid.getAdSkippableState=function(){return!1},vpaid.getAdVolume=function(){return this.adVolume},vpaid.setAdVolume=function(a){this.adVolume=1*a},utils.implementPubSub(vpaid,function(a){return!!CONST.VPAID_EVENTS[a]}),window.getVPAIDAd=function(){for(var a={},e=0;e<vpaidMethods.length;e++){var i=vpaidMethods[e];a[i]=function(a){return function(){if("subscribe"!==a&&utils.info("PLAYER SAID:",a),vpaid.campaignsManager)try{return vpaid.campaignsManager.vpaidCall(a,arguments)}catch(a){}return vpaid[a].apply(vpaid,arguments)}}(i)}return a};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./CampaignsManager":7,"./adsLoader":10,"./const":11,"./cookieSync":12,"./debugger":13,"./locationProvider":15,"./lodashCustom":16,"./newStat":17,"./oldStat":18,"./scoring/ScoringManager":33,"./ui":37,"./url.js":38,"./utils":39,"node-sk-promise":1}],15:[function(require,module,exports){
function getSyndicationDomain(){var t=document.getElementsByTagName("script"),r=_.find(t,function(t){try{return t.src.match(/(jsvpaid.+vast_domain=)([^&]+)/gi)}catch(t){return null}});try{return decodeURIComponent(r.src.match(/vast_domain=([^&]*)/)[1])}catch(t){}return null}function getMostTopWindow(t){if(t===t.top)return t;try{t.parent.location.href;return fifCount++,getMostTopWindow(t.parent)}catch(r){return t}}function getTopLocation(t,r){if(!isInIframe)return location.href;if(isInSecureIframe)return document.referrer;if(isFif){fifCount=0;var n=getMostTopWindow(t);return n===window.top||r?n.location.href:n.document.referrer}}function getUri(){try{return isFif?getTopLocation(window,!0):location.href}catch(t){}return"undefined"}function getHost(t){try{return t.match(/(https?:\/\/|www\.|^)([^\/|\?\s]+)/gi).shift()}catch(t){}return t}function isInFif(){try{return!!parent.location.href}catch(t){return!1}}function inIframe(){try{return window.self!==window.top}catch(t){return!0}}function inSecureIframe(){try{return!window.parent.location.href}catch(t){return!0}}var fifCount=0,urlModule=require("./url.js"),isInIframe=inIframe(),isFif=isInFif(),isInSecureIframe=inSecureIframe(),protocol=urlModule.parse(getUri()).protocol,syndicationDomain=getSyndicationDomain(),url=syndicationDomain||getUri(),host=getHost(url),topUrl=syndicationDomain||getTopLocation(window),topHost=getHost(topUrl);module.exports=function(t){return{isInIframe:isInIframe,isFif:isFif,isInSecureIframe:isInSecureIframe,domain:host,full_page_url:url,top_domain:topHost,top_page_url:topUrl,final_domain:t&&isInIframe?topHost:host,final_page_url:t&&isInIframe?topUrl:url,protocol:protocol,fifCount:fifCount,ua:navigator.userAgent}};
},{"./url.js":38}],16:[function(require,module,exports){
var _={isArray:function(n){return"[object Array]"===Object.prototype.toString.call(n)},each:function(n,r){if(n)for(var t in n)n.hasOwnProperty(t)&&r.call(n,n[t],t)},flatten:function(n){var r=[];return _.each(n,function(n){r=r.concat(n)}),r},noop:function(){return function(){}},get:function(n,r,t){var e=n;try{return _.each(r,function(n){e=e[n]}),void 0===e?t:e}catch(n){return t}},find:function(n,r){if(n)for(var t=0;t<n.length;t++)if(r(n[t]))return n[t]},difference:function(n,r){var t=[];return _.each(n,function(n){-1==r.indexOf(n)&&t.push(n)}),t},map:function(n,r){var t=[];if(n){for(var e=0;e<n.length;e++)t.push(r.call(n[e],n[e],e));return t}},zipObject:function(n,r){var t={};return _.each(n,function(n,e){t[n]=r[e]}),t},keys:function(n){var r=[];if(n){for(var t in n)n.hasOwnProperty(t)&&r.push(t);return r}},filter:function(n,r){var t=[];return _.each(n,function(n){!0===r(n)&&t.push(n)}),t},omit:function(n,r){var t={};return _.each(n,function(n,e){-1==r.indexOf(e)&&(t[e]=n)}),t},extend:function(){var n=Array.prototype.slice.call(arguments,1),r=arguments[0];return _.each(n,function(n){n&&_.each(n,function(n,t){r[t]=n})}),r}};module.exports=_;
},{}],17:[function(require,module,exports){
function VastStat(t){this.config={},this.sender=new Sender,this.bindWindowClose()}var utils=require("./utils.js"),Sender=require("./sender.js"),inherits=require("util").inherits;inherits(VastStat,require("./oldStat")),VastStat.prototype.setUrls=function(t){this.sender.set_urls(t)},VastStat.prototype.log=function(t){if(this.disabled)return Promise.resolve();if(!("VPAIDXMLRequested"!==t.event||vpaid&&vpaid.settings&&vpaid.settings.sendRequestRow))return Promise.resolve();if(!("VPAIDConfigReceived"!==t.event||vpaid&&vpaid.settings&&vpaid.settings.sendAuxEvents))return Promise.resolve();var e=_.extend(_.omit(t,["event"]),_.omit(this.config,["url"]),{tte:this.getTTE()});return this.sender.add_to_queue(CONST.NEWSTAT_TRACKING_URLS[t.event],e),Promise.resolve()},VastStat.prototype.bindWindowClose=function(){function t(t){var i=CONST.NEWSTAT_TRACKING_URLS.PlayerEvent,n=_.extend({event_type:CONST.VPAID_EVENT_CODES.WindowClose,tte:e.getTTE()},_.omit(e.config,["url"])),s=e.sender.get_active_domain(),o=utils.uniteUrlPath(s,i);utils.ajaxLoad(o,n)}var e=this;utils.addEvent(window,"beforeunload",t)},VastStat.prototype.finalize=function(){return this.sender.finalize()},VastStat.prototype.sendPostData=function(t,e,i){var n=this.sender.get_active_domain(),s=CONST.NEWSTAT_TRACKING_URLS.MARKUP,o=utils.uniteUrlPath(n,s),r=_.extend({event:e,page_url:locationInfo.final_page_url,cmpId:i},_.omit(this.config,["url","adId","domain","height","width"]));utils.ajaxLoad(o,r,null,null,t)},VastStat.prototype.sendCookieSyncUrls=function(t){this.sender.add_to_queue(null,null,t)},module.exports=VastStat;
},{"./oldStat":18,"./sender.js":36,"./utils.js":39,"util":5}],18:[function(require,module,exports){
"use strict";function Logger(t){this.config=t,this.qLength=0,utils.implementPubSub(this)}var utils=require("./utils.js");Logger.prototype.handleEmpty=function(){0===this.qLength&&this.emit("empty")},Logger.prototype.finalize=function(){if(utils.log("Logger queue length",this.qLength),this.qLength<=0)return Promise.resolve();var t=this;return new Promise(function(e){t.on("empty",function(){setTimeout(function(){e()},20)})})},Logger.prototype.disable=function(){this.disabled=!0},Logger.prototype.sendImpression=function(t){var e={},i=this;i.disabled||(scoringManager.scoreSAS("i",vpaid.settings),this.config.traking&&(t.isRevShare()&&(e[111]=1e3*t.data.revShareCost),i.qLength++,utils.ajaxLoad(this.config.traking.impression.eventLink,{cmpId:t.data.cmpId,protocol:t.getCreativeType(),cmpPerformance:JSON.stringify(e),wp:t.data._waterFallIndex,tte:i.getTTE(),t:i.config.t,v:i.config.v,fi:t.data.feedId}).catch(function(){utils.log("cant send log")}).then(function(t){return i.qLength--,i.handleEmpty(),t})))},Logger.prototype.addConfig=function(t){this.config=_.extend({},this.config,t)},Logger.prototype.startTimer=function(){this.timerStarted=!0,this.timerStartedAt=Date.now()},Logger.prototype.getTTE=function(){return this.timerStarted?Date.now()-this.timerStartedAt:0},module.exports=Logger;
},{"./utils.js":39}],19:[function(require,module,exports){
function Queue(t,i){this.pending=t,this.currentCount=0,this.failures=0;var n=new Promise.defer,e=!1,r=[];this.cancel=function(t){e=!0,this.pending=[],_.each(r,function(i){i!=t&&i.cancel()})},this.allFailed=function(){for(var t=0;t<r.length;t++)if(!r[t].isRejected())return!1;return!0},this.trackFail=function(){this.failures++},this.drain=function(){if(0==this.pending.length&&0==this.currentCount)return void(this.allFailed()?n.reject():n.resolve());if(!(0==this.pending.length||this.currentCount>=i||e)){var t=this.pending.shift(),s=this;s.currentCount++;var u=t();r.push(u),u.catch(this.trackFail.bind(this)).then(function(){s.currentCount--,s.drain()})}},this.start=function(){for(var t=0;t<i;t++)this.drain();return n.promise}}module.exports=Queue;
},{}],20:[function(require,module,exports){
var ComScore=function(){this.scoring_type=9,this.old_scoring_type="comscore",this.log_result=!0,this.consider_result=!0};ComScore.prototype.score=function(t,c){var e=parseInt(vpaid.settings.aid);return utils.loadScript("//b.measuread.com/rs/test/am.js#c1=27&c2=22000559&c3=22000559_AM&c4="+c.data.cmpId+"&c5="+(1e3*e+1e3*Math.random())+"&c6=&c10=&c11=&c13=&c16=gen").then(function(){return new Promise(function(t){setTimeout(function(){"undefined"==typeof mls&&(mls=2),t(0!=mls?!0:!1)},250)})}).catch(function(){throw{noAccess:!0}})},module.exports=ComScore;
},{}],21:[function(require,module,exports){
var utils=require("../utils"),VertaScore=function(){this.scoring_type=5,this.old_scoring_type="verta_firewall",this.log_result=!0,this.consider_result=!0};VertaScore.prototype.score=function(e){var t=_.get(vpaid,["settings","tw"]),r=_.get(vpaid,["settings","endpoints","firewall"]);return void 0===t?utils.ajaxLoad(utils.uniteUrlPath(r,"/verta_score"),null,4e3).then(function(e){return JSON.parse(e).result}):Promise.resolve(!!t)},module.exports=VertaScore;
},{"../utils":39}],22:[function(require,module,exports){
var Forensiq=function(){var e=this;e.scoring_type=4,e.old_scoring_type="forensiq",e.ORG_ID="nuphuc2abrev7gusep3m",e.cbName="__ff"+Math.floor(1e4*Math.random())+"f"+Math.floor(1e4*Math.random()),e.defered=new Defer,e.log_result=!0,e.consider_result=!0,window[this.cbName]=function(o){200==o?e.defered.resolve(!0):e.defered.resolve(!1)}};Forensiq.prototype.score=function(e){var o=this;return utils.loadScript("//s.fqtag.com/b?org="+o.ORG_ID+"&callback="+o.cbName+"&p="+e.aid+"&a="+e.sid+"&url="+encodeURIComponent(window.location.host)+"&cmp=VIDEO&sk=XKdgC7IqfmwQbZTebCwb").catch(function(){o.defered.reject({noAccess:!0})}),setTimeout(function(){o.defered.reject({timeout:!0})},CONST.SCORING_TIMEOUT),o.defered.promise},module.exports=Forensiq;
},{}],23:[function(require,module,exports){
var Session=require("./Session"),utils=require("../utils"),ForensiqS2S=function(){this.scoring_type=11,this.old_scoring_type="forensiq_s2s",this.ORG_ID="nuphuc2abrev7gusep3m",this.sessionId=Session.sessionId,this.log_result=!0,this.consider_result=!0};ForensiqS2S.prototype.score=function(s,e){var i=this;return utils.ajaxLoad(i.getRequestDataUrl(s,e),null,CONST.SCORING_TIMEOUT).then(function(s){var e=JSON.parse(s);return e.f.riskScore>=0&&e.f.riskScore<=64}).catch(function(){throw{noAccess:!0}})},ForensiqS2S.prototype.getRequestDataUrl=function(s,e){var i=vpaid.settings.endpoints.forensiq,r={s:this.sessionId,p:s.aid,a:s.sid,rd:s.domain,ua:s.ua,orgid:this.ORG_ID,cmp:""};return i+"for/?"+utils.convertObjToSearchStr(r)},module.exports=ForensiqS2S;
},{"../utils":39,"./Session":34}],24:[function(require,module,exports){
var Session=require("./Session"),ForensiqTag=function(){this.scoring_type=2,this.old_scoring_type="forensiqTag",this.ORG_ID="nuphuc2abrev7gusep3m",this.AD_FORMAT="video",this.REQ_TYPE="display",this.sessionId=Session.sessionId,this.log_result=!1,this.consider_result=!1};ForensiqTag.prototype.score=function(s){var e=this;return utils.loadScript(e.getScoringUrl(s)).catch(function(){throw{noAccess:!0}})},ForensiqTag.prototype.getScoringUrl=function(s){return"//c.fqtag.com/tag/implement-r.js?org="+this.ORG_ID+"&s="+this.sessionId+"&p="+s.aid+"&a="+s.sid+"&cmp=&fmt="+this.AD_FORMAT+"&rd="+encodeURIComponent(s.domain)+(s.placementId?"&ad="+encodeURIComponent(s.placementId):"")+"&rt="+this.REQ_TYPE+"&sl=1&fq=1"},module.exports=ForensiqTag;
},{"./Session":34}],25:[function(require,module,exports){
var FraudLogix=function(){this.scoring_type=13,this.old_scoring_type="fraudlogix",this.log_result=!1,this.consider_result=!1};FraudLogix.prototype.score=function(i,t){var o="https://pixel.yabidos.com/fltiu.js?qid=536393f5037393f5237363&cid=672&p="+i.sid+"&s="+encodeURIComponent(i.domain)+"&x="+i.aid+"&adtg="+i.aid+"&h="+i.height+"&w="+i.width+"&ip="+i.uip+"&ua="+encodeURIComponent(i.ua);return utils.loadScript(o).then(function(){return!0}).catch(function(){return!1})},module.exports=FraudLogix;
},{}],26:[function(require,module,exports){
var IASScore=function(){var e=this;e.scoring_type=1,e.old_scoring_type="ias",e.defered=new Defer,e.log_result=!1,e.consider_result=!1,window.__IntegralASConfig={onInViewMRC:function(){utils.log("scoring IAS on view")},onMeasurable:function(){utils.log("scoring IAS on measurable")},onAPIResult:function(o){var t=1e3===o.rsa;utils.log("IAS SCORING RESULT",o),e.defered.resolve(t)}}};IASScore.prototype.score=function(e){var o=this;return utils.loadScript("//8304.bapi.adsafeprotected.com/bapi?anId=8304&advId=VIDEE&campId=VIDEO&pubId="+e.aid+"&chanId="+e.sid+"&auth_token="+_.get(vpaid,["settings","ias_token"])+"&placementId="+(e.extra?e.extra:encodeURIComponent(window.location.host))).catch(function(){o.defered.reject({noAccess:!0})}),setTimeout(function(){o.defered.reject({timeout:!0})},CONST.SCORING_TIMEOUT),o.defered.promise},module.exports=IASScore;
},{}],27:[function(require,module,exports){
var MOAT=function(){function t(t,e,n,a,i){var o=document.createElement("script"),s=[];e={adData:{ids:e,duration:n,url:i},dispatchEvent:function(t){this.sendEvent?(s&&(s.push(t),t=s,s=!1),this.sendEvent(t)):s.push(t)}},n="_moatApi"+Math.floor(1e8*Math.random());var r,c;try{r=t.ownerDocument,c=r.defaultView||r.parentWindow}catch(t){r=document,c=window}return c[n]=e,o.type="text/javascript",t&&t.insertBefore(o,t.childNodes[0]||null),o.src="https://z.moatads.com/"+a+"/moatvideo.js#"+n,e}this.scoring_type=6,this.old_scoring_type="moat",this.log_result=!1,this.consider_result=!1,this.score=function(e,n){return utils.log("MOAT scoring start"),new Promise(function(a){var i=t(vpaid.parameters.container,{level1:e.aid,level2:e.sid,level3:n.data.cmpId,level4:"videe",slicer1:e.domain},30,"vertamediajsvideo5595384985");_.each(CONST.MOAT_EVENTS,function(t){vpaid.campaignsManager.on(t,function(){utils.log("moat scoring sending campaign event",t);try{var e=n.vpaidCall("getAdVolume");i.dispatchEvent({type:t,adVolume:e}),utils.log("moat scoring sent campaign event",t,"adVolume",e)}catch(e){utils.log("moat scoring cant sent campaign event",t,e)}})}),a(!0)}).catch(function(){return!1})}};module.exports=MOAT;
},{}],28:[function(require,module,exports){
var MOATIMA=function(){function e(e,t,o){if(!1===t.hasOwnProperty("partnerCode"))return!1;var i=document.createElement("script");if(o=o||e&&(void 0!==e.O?e.O.parentNode:document.body)||document.body,listeners=[],moatapi={adsManager:e,ids:t,imaSDK:!0,events:[]},eventMapping={complete:"AdVideoComplete",firstquartile:"AdVideoFirstQuartile",impression:"AdImpression",loaded:"AdLoaded",midpoint:"AdVideoMidpoint",pause:"AdPaused",skip:"AdSkipped",start:"AdVideoStart",thirdquartile:"AdVideoThirdQuartile",volumeChange:"AdVolumeChange"},google&&google.ima&&e){var n,a="_moatApi"+Math.floor(1e8*Math.random());for(n in google.ima.AdEvent.Type){var r=function(t){if(moatapi.sendEvent){for(t=listeners.length-1;0<=t;t--)e.removeEventListener(listeners[t].type,listeners[t].func);moatapi.sendEvent(moatapi.events)}else moatapi.events.push({type:eventMapping[t.type]||t.type,adVolume:e.getVolume()})};e.addEventListener(google.ima.AdEvent.Type[n],r),listeners.push({type:google.ima.AdEvent.Type[n],func:r})}}var d,s,a=void 0!==a?a:"";try{d=o.ownerDocument,s=d.defaultView||d.parentWindow}catch(e){d=document,s=window}s[a]=moatapi,i.type="text/javascript",o&&o.appendChild(i),i.src="https://z.moatads.com/"+t.partnerCode+"/moatvideo.js#"+a}this.scoring_type=6,this.old_scoring_type="moat",this.log_result=!1,this.consider_result=!1,this.scored=!1,this.score=function(t,o){return utils.log("MOAT IMA scoring start"),this.scored=!0,new Promise(function(i){var n={partnerCode:"electusimaint41136361737",viewMode:google.ima.ViewMode.NORMAL,slicer1:t.domain,slicer2:t.page_url};e(o.adsManager,n,o.imaContainer),i(!0)}).catch(function(){return!1})}};module.exports=MOATIMA;
},{}],29:[function(require,module,exports){
var PixalateTag=function(){this.scoring_type=17,this.old_scoring_type="pixalateTag",this.log_result=!1,this.consider_result=!1};PixalateTag.prototype.score=function(t){var i=this;return utils.loadScript(i.getScoringUrl(t)).catch(function(){throw{noAccess:!0}})},PixalateTag.prototype.getScoringUrl=function(t){return"https://adrta.com/i?clid=vtm&paid=vtm&dvid=v&avid=&plid="+t.adId+"&siteId="+t.aid+"&caid=1&publisherId="+t.pubId+"&kv7=&kv1="+t.width+"X"+t.height+"&kv2="+encodeURIComponent(locationInfo.final_page_url)+"&kv3=&kv4="+t.uip+"&kv11=&kv20=1&kv26=&kv27="+t.ua+"&kv24="+(CONST.ENV_MAP[t.env]||"Desktop_Video")},module.exports=PixalateTag;
},{}],30:[function(require,module,exports){
var Pixelate=function(t,e){this.type=t,this.scoring_type=e,this.old_scoring_type=t,this.log_result=!0,this.consider_result=!0};Pixelate.prototype.score=function(t){var e=_.get(vpaid,["settings",this.type]);return Promise.resolve(!!e)},module.exports=Pixelate;
},{}],31:[function(require,module,exports){
var Session=require("../Session"),utils=require("../../utils"),ForensiqS2sSAS=function(s){this.scoring_type=19,this.old_scoring_type="forensiq_s2s",this.ORG_ID="3axjFlo0KxYI7wuFF5MW",this.sessionId=Session.sessionId,this.log_result=!0,this.consider_result=!0,this.sasId=s};ForensiqS2sSAS.prototype.score=function(s,t){var i=this;return utils.ajaxLoad(i.getRequestDataUrl(s,t),null,CONST.SCORING_TIMEOUT).then(function(s){var t=JSON.parse(s);return t.f.riskScore>=0&&t.f.riskScore<=64}).catch(function(){throw{noAccess:!0}})},ForensiqS2sSAS.prototype.getRequestDataUrl=function(s,t){var i=vpaid.settings.endpoints.forensiq,e={s:this.sessionId,p:"sas_"+s.aid,a:s.sid,rd:s.domain,ua:s.ua,orgid:this.ORG_ID,cmp:t.data.cmpId};return i+"for/?"+utils.convertObjToSearchStr(e)},module.exports=ForensiqS2sSAS;
},{"../../utils":39,"../Session":34}],32:[function(require,module,exports){
var Session=require("../Session"),ForensiqTagSAS=function(s){this.scoring_type=18,this.old_scoring_type="forensiqTag",this.ORG_ID="nuphuc2abrev7gusep3m",this.AD_FORMAT="video",this.REQ_TYPE="display",this.sessionId=Session.sessionId,this.log_result=!1,this.consider_result=!1,this.sasId=s};ForensiqTagSAS.prototype.score=function(s,t){var e=this;return utils.loadScript(e.getScoringUrl(s,t)).catch(function(){throw{noAccess:!0}})},ForensiqTagSAS.prototype.getScoringUrl=function(s,t){return"//c.fqtag.com/tag/implement-r.js?org="+this.ORG_ID+"&s="+this.sessionId+"&p=sas_"+s.aid+"&a="+s.sid+"&cmp="+t.data.cmpId+"&fmt="+this.AD_FORMAT+"&rd="+encodeURIComponent(s.domain)+(s.placementId?"&ad="+encodeURIComponent(s.placementId):"")+"&rt="+this.REQ_TYPE+"&sl=1&fq=1"},module.exports=ForensiqTagSAS;
},{"../Session":34}],33:[function(require,module,exports){
var ScoringManager=function(e){function t(e,t,r){var n=e.old_scoring_type,i={cmpId:r.data.cmpId,scoring_type:e.scoring_type};return void 0!=e.sasId&&(i.sas_id=e.sasId),newStat.log(_.extend(i,{event:"ScoringRequest"})),e.score(t,r).then(function(t){return utils.log("SCORING SYSTEM ",n,e.scoring_type," RESULTED IN ",t),("boolean"!=typeof e.log_result||e.log_result)&&newStat.log(_.extend(i,{event:t?"ScoringGood":"ScoringBad"})),!e.consider_result||t}).catch(function(t){return utils.log("SCORING SYSTEM ",n,e.scoring_type," FAILED",t),("boolean"!=typeof e.log_result||e.log_result)&&newStat.log(_.extend(i,{event:t.timeout?"ScoringTimeout":"ScoringNoAccess"})),!e.consider_result})}function r(e,r){if(!e.data.sc[r])return Promise.resolve(!0);if(void 0!==p[r])return utils.log("scoring from cache",r),p[r];if(S[r]){utils.log("start scoring ",r);var n=t(S[r],i.data,e);return p[r]=n,n}return utils.log("no scoring implementation",r),Promise.resolve(!0)}function n(){return[32744,32756,32762,32763,32764,36621,39356,263693,267593].indexOf(i.data.pubId)>=0}this.data=e;var i=this,a=require("../Campaign"),o={fs:require("./SAS/ForensiqS2sSAS"),ft:require("./SAS/ForensiqTagSAS")},s=new(require("./MOAT")),u=new(require("./MOATIMA")),c=new(require("./ComScore")),d=new(require("./ForensiqTag")),g=new(require("./PixalateTag")),l=new(require("./FraudLogix")),f=!0,S=[new(require("./IAS")),new(require("./ForensiqS2S")),null,new(require("./ForensiqFW")),new(require("./Firewall")),new(require("./Pixelate"))("tpd",8),new(require("./Pixelate"))("tpi",7),new(require("./VertaS2S"))],p=[];this.firewall=function(e){return r(e,4)},this.vms2s=function(e){return r(e,7)},this.trackFqTag=function(e){t(d,this.data,e)},this.trackPxTag=function(e){t(g,this.data,e)},this.trackMoatima=function(e){!u.scored&&n()&&t(u,this.data,e)},this.score=function(e){var i=this;return f&&(vpaid.settings.tm&&!n()&&t(s,i.data,e),vpaid.settings.tf&&t(l,i.data,e),vpaid.settings.tc&&t(c,i.data,e),vpaid.settings.tq&&this.trackFqTag({data:{cmpId:1}}),vpaid.settings.tp&&this.trackPxTag({data:{cmpId:1}}),f=!1),Promise.all(_.map(e.data.sc,function(t,n){return r(e,n)})).then(function(e){if(!e)return!1;for(var t=0;t<e.length;++t)if(!e[t])return!1;return!0})},this.scoreSAS=function(e,r){var n=r instanceof a?r.data.sas:r.sas;if(n){var i=[],s=[],u=this;return _.each(n,function(n){o[n.type]&&n.place==e&&i.push(t(new o[n.type](n.id),u.data,r instanceof a?r:{data:{cmpId:0}}).then(function(e){s.push(e)}))}),Promise.all(i).then(function(){_.each(s,function(e){if(!e)throw new Error(CONST.CAMPAIGN_ERRORS.scoring_error)})})}}};module.exports=ScoringManager;
},{"../Campaign":6,"./ComScore":20,"./Firewall":21,"./ForensiqFW":22,"./ForensiqS2S":23,"./ForensiqTag":24,"./FraudLogix":25,"./IAS":26,"./MOAT":27,"./MOATIMA":28,"./PixalateTag":29,"./Pixelate":30,"./SAS/ForensiqS2sSAS":31,"./SAS/ForensiqTagSAS":32,"./VertaS2S":35}],34:[function(require,module,exports){
var sessionId=1e7*Math.random()+String((new Date).getTime());module.exports={sessionId:sessionId};
},{}],35:[function(require,module,exports){
var utils=require("../utils"),VertaS2S=function(){this.scoring_type=16,this.old_scoring_type="vm_s2s",this.log_result=!0,this.consider_result=!0};VertaS2S.prototype.score=function(t,e){var i=this;return utils.ajaxLoad(i.getRequestDataUrl(t),null,CONST.SCORING_TIMEOUT).then(function(t){return!JSON.parse(t).isBot}).catch(function(){throw{noAccess:!0}})},VertaS2S.prototype.getRequestDataUrl=function(t){var e=vpaid.settings.endpoints.vms2s,i={aid:t.aid,sid:t.sid,domain:t.domain,ip:t.uip,height:t.height,width:t.width};return e+"vmw/?"+utils.convertObjToSearchStr(i)},module.exports=VertaS2S;
},{"../utils":39}],36:[function(require,module,exports){
function Sender(t){this.opt=_.extend({},Sender.defaults,t),this.sending=!1,this.queue=[],this.errors=0,this.url_num=0,this.finalizing=!1,utils.implementPubSub(this),this.init()}var _=require("./lodashCustom.js"),utils=require("./utils.js");Sender.defaults={urls:[],resending:1,periods:[50,100,200,500]},Sender.prototype.init=function(){var t=this.opt.urls.length;0===t&&(this.url_num=0),this.url_num=utils.getRandomInt(0,t-1)},Sender.prototype.change_url=function(){this.opt.urls.length<=1||(this.url_num=(this.url_num+1)%this.opt.urls.length)},Sender.prototype.check_queue=function(){var t=this;if(this.try_finalized(),!this.sending&&0!=this.queue.length&&this.opt.urls&&this.opt.urls[this.url_num]){this.sending=!0;var e=this.queue[0];this.finalizing||0==this.errors?this.send(e):setTimeout(function(){t.send(e)},this.get_period())}},Sender.prototype.get_period=function(){return this.opt.periods[Math.min(this.errors,this.opt.periods.length)-1]},Sender.prototype.send=function(t){var e=this,i=t.url?t.url:utils.uniteUrlPath(this.opt.urls[this.url_num],t.path);utils.ajaxLoad(i,t.data).then(function(t){e.queue.shift(),e.errors=0,e.sending=!1,e.check_queue()}).catch(function(i){++e.errors,e.change_url(),e.finalizing||t.count>=e.opt.resending?e.queue.shift():++t.count,e.sending=!1,e.check_queue()})},Sender.prototype.add_to_queue=function(t,e,i){this.finalizing||(this.queue.push({path:t,data:e,count:0,url:i}),this.check_queue())},Sender.prototype.set_urls=function(t){this.opt.urls=t,this.init(),this.check_queue()},Sender.prototype.get_queue_size=function(){return this.queue.length},Sender.prototype.try_finalized=function(){!this.finalizing||this.sending||this.queue.length>0||this.emit("finalized")},Sender.prototype.finalize=function(){var t=this;return this.finalizing=!0,0==this.get_queue_size()?Promise.resolve():new Promise(function(e){t.subscribe(e,"finalized")})},Sender.prototype.get_active_domain=function(){return this.opt.urls[this.url_num]},module.exports=Sender;
},{"./lodashCustom.js":16,"./utils.js":39}],37:[function(require,module,exports){
var UI=function(e,t){e&&e.parentElement||(e=document.createElement("div"),t.parentElement.appendChild(e));var n=[];this.clear=function(){_.each(n,function(t){if(t&&e)try{e.removeChild(t)}catch(e){}})},this.showSkipButton=function(t,i,o,r,a){if(e){o&&(e=r.querySelector("div"));var l=document.createElement("span"),p=function(){l.onclick=function(t){t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),e.removeChild(l),i&&i()}};return n.push(l),t?l.innerHTML="You can skip ad after "+t:(l.innerHTML="Skip Ad >>",p()),l.style.position="absolute",l.style.right=o?"0":"5px",l.style.bottom=o?"37px":"10%",l.style.padding="10px 15px",l.style.background=o?"black":"rgba(0,0,0,0.5)",l.style.color="white",l.style.border="1px solid white",l.style.cursor="pointer",l.style.zIndex=3,a&&(l.style.width="190px",l.style.fontSize="20px",l.style.textAlign="center"),e.appendChild(l),function(e){e=Math.abs(e);var n=Math.ceil(t-e);if(n<=0)return l.innerHTML="Skip Ad >>",p(),!0;l.innerHTML="You can skip ad after "+n}}}};module.exports=UI;
},{}],38:[function(require,module,exports){
function prepareUrl(r){return r=r||"",re_strip.lastIndex=0,r=strip(r),r=r.toLowerCase(),unescapeUrl(r)}function getProtocol(r){r=r||"",re_protocol.lastIndex=0;var e=re_protocol.exec(r);return e&&e[1]?e[1]:null}function removeProtocol(r){var e=r.split("?"),t=e.slice(1).join("?");return t&&(t="?"+t),e=e[0],~e.indexOf("://")?e.split("://").slice(1).join("://")+t:0===e.indexOf("//")?e.substr(2)+t:~e.indexOf(":")?e.split(":").slice(1).join(":")+t:null}function unescapeUrl(r){var e=/(\:|\?|\/)/gi;try{for(var t=decodeURIComponent(r);~r.indexOf("%")&&!e.test(r)&&t!==r;)e.lastIndex=0,r=t,t=decodeURIComponent(r)}catch(e){return r}return r}function getHost(r){return r=prepareUrl(r),r=removeProtocol(r),r&&(r=r.split("/")[0]),r||null}function strip(r){r=r||"",re_strip.lastIndex=0;var e=re_strip.exec(r);return e&&e[1]?e[1]:""}function getQuery(r){var e,t,o={};r=prepareUrl(r);var e=r.split("?");e=e.slice(1).join("?").split("&");for(var n=0;n<e.length;++n)t=e[n].split("="),2==t.length&&(o[t[0]]=t[1]);return o}function parse(r,e){var t={};return r=prepareUrl(r),t.protocol=getProtocol(r),t.query=getQuery(r),t.host=getHost(r),t}var re_strip=/^\s*([^\s]*)\s*$/gi,re_protocol=/^([a-z][\w-]+:)\/\//gi,re_host=/\w[\w]*/gi;module.exports={strip:strip,getProtocol:getProtocol,getQuery:getQuery,getHost:getHost,parse:parse};
},{}],39:[function(require,module,exports){
(function (global){
"use strict";function GetIEVersion(){var e=window.navigator.userAgent,t=e.indexOf("MSIE");return t>0?parseInt(e.substring(t+5,e.indexOf(".",t))):navigator.userAgent.match(/Trident\/7\./)?11:0}function log(){var e=Array.prototype.slice.call(arguments,0);if(!~e.indexOf("getAdRemainingTime")&&!~e.indexOf("AdRemainingTimeChange")){e.unshift(utils.now()+"|"+hash+"|");try{console.log.apply(console,e)}catch(t){try{console.log(JSON.stringify(e))}catch(e){}}}}var hash=(1e4*(Math.random()+1)|0).toString(16).substring(0,4),utils={removeEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e[t]=n},addEvent:function(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e[t]=n)},Defer:function(){var e,t,n=new Promise(function(){e=arguments[0],t=arguments[1]});return{resolve:e,reject:t,promise:n}},loadScript:function(e,t,n){var o=t||document.body;return new Promise(function(i,r){if(n)try{var a=t.getElementsByTagName("script");if(_.find(a,function(t){return t.src.match(e)}))return void i()}catch(e){}var c=document.createElement("script");c.src=e,c.onload=function(){i()},c.onerror=function(){r()},o.appendChild(c)})},now:function(){return(new Date).getTime()},useIma:function(e,t){return CONST.IMA_AID_LIST.indexOf(parseInt(e.aid))>=0||e.useIma||t.data.useIma},ajaxLoad:function(e,t,n,o,i){return new Promise(function(r,a){var c=i?"POST":"GET",u=e.match("\\?")?"":"?";t=t||{};for(var s in t)t.hasOwnProperty(s)&&(u+=("?"==u.charAt(u.length-1)?"":"&")+s+"="+encodeURIComponent(t[s]));~(e+u).indexOf("?cb=")||~(e+u).indexOf("&cb=")||(u+=(~u.indexOf("?")||~e.indexOf("?")?"&":"?")+"cb="+utils.now());try{var l=GetIEVersion(),d=8==l||9==l||10==l;(d||locationInfo.fifCount>1)&&(e=e.replace(/^\/\/|^http:\/\/|^about:\/\/|^https:\/\/|^\/\//i,locationInfo.protocol+"//"));for(var p=window;;)try{if(p.self===p.parent||!p.parent.location.href)break;p=p.parent}catch(e){break}var f=d?"XDomainRequest":"XMLHttpRequest",h=new p[f];try{n&&(h.timeout=n)}catch(e){utils.log(e,"can't set ajax timeout")}h.ontimeout=function(){a(new Error(global.CONST.CAMPAIGN_ERRORS.xml_timeout))},d&&(h.onload=function(){r(h.responseText)}),h.onprogress=function(){},h.onreadystatechange=function(){4==h.readyState&&(200==h.status?r(h.responseText):a(new Error(global.CONST.CAMPAIGN_ERRORS.xml_network_error)))},h.onerror=function(){a(new Error(global.CONST.CAMPAIGN_ERRORS.xml_network_error))},utils.info("trying get",e+u),h.open(c,e+u,!0),("boolean"!=typeof o||o)&&(h.withCredentials=!0),i&&h.setRequestHeader("Content-type","text/plain"),setTimeout(function(){h.send(i)},0)}catch(t){a(new Error(global.CONST.CAMPAIGN_ERRORS.xml_unknown)),utils.log(e,"error on sending ajax request",t)}})},trackVastEvent:function(e){return new Promise(function(t,n){var o=new Image;o.onload=t,o.onerror=n,o.src=e})},containsOnlyCDATA:function(e){var t,n=e.innerHTML;return void 0===n&&"undefined"!=typeof XMLSerializer?(n=(new XMLSerializer).serializeToString(e),t=/^\s*<[^>]*>\s*<!\[CDATA\[[^\[\]]+\]\]>\s*<[^>]*>\s*$/gi):t=/^\s*<!\[CDATA\[[^\[\]]+\]\]>\s*$/gi,!!t.exec(n)},xmlToJson:function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0){t._attributes={};for(var n=0;n<e.attributes.length;n++){var o=e.attributes.item(n);t._attributes[o.nodeName]=o.nodeValue}}}else 3==e.nodeType?t=e.nodeValue:4==e.nodeType&&(t=e.textContent);if(e.hasChildNodes())if(void 0===e.innerHTML&&utils.containsOnlyCDATA(e))t._cdata=e.textContent;else for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes.item(i),a=function(e){return{"#text":"_text","#cdata-section":"_cdata"}[e]||e}(r.nodeName);if(void 0===t[a])t[a]=utils.xmlToJson(r);else{if(void 0===t[a].push){var c=t[a];t[a]=[],t[a].push(c)}t[a].push(utils.xmlToJson(r))}}return t},once:function(e,t,n){utils.addEvent(e,t,function o(){utils.removeEvent(e,t,o),n.apply(this,arguments)},!1)},getScheme:function(){var e;try{var t=window;for(e=t.location.protocol;t.top!==t.self&&"https:"!==e;)t=t.top,e=t.location.protocol}catch(e){return"http"}return e.split(":")[0]},getCsubid:function(e){return String(e).length>2?String(e).substr(0,2)+((new Date).getHours()+10)+String(e).substring(2):0},getPlacementId:function(e,t){var n;try{n=e.getAttribute("id")||t.getAttribute("id")}catch(e){}return n||""},prepareUrl:function(e,t,n){return e=e.replace(/\{cb\}/gi,t.cb).replace(/\{(vid_)?duration\}|\{video_duration\}/gi,t.vidDuration||30).replace(/\{domain\}|\{site_url\}|\{(content_)?page_url\}/gi,encodeURIComponent(locationInfo.domain)).replace(/\{full_page_url\}|\{site_full_url\}/gi,encodeURIComponent(locationInfo.full_page_url)).replace(/\{iframe_domain\}|\{top_domain\}/gi,encodeURIComponent(locationInfo.top_domain)).replace(/\{full_iframe_page_url\}|\{top_page_url\}/gi,encodeURIComponent(locationInfo.top_page_url)).replace(/\{iframe_(content_)?page_url\}/gi,encodeURIComponent(locationInfo.top_domain)).replace(/\{final_domain\}/gi,encodeURIComponent(locationInfo.final_domain)).replace(/\{final_page_url\}/gi,encodeURIComponent(locationInfo.final_page_url)).replace(/\{player_width\}|\{width\}/gi,t.width).replace(/\{player_height\}|\{height\}/gi,t.height).replace(/\{uip\}|\{ip\}/gi,t.uip).replace(/\{ua\}/gi,encodeURIComponent(locationInfo.ua)).replace(/\{aid\}/gi,t.aid).replace(/\{sid\}/gi,t.sid).replace(/\{csubid\}/gi,t.csubid).replace(/\{placementId\}/gi,encodeURIComponent(t.placementId)).replace(/\{scheme\}/gi,t.scheme),_.each(n,function(t,n){e=e.replace(new RegExp("\\{"+n+"\\}","gi"),t)}),t.macro?e.replace(/\{video_description\}/gi,encodeURIComponent(t.macro.video_description)).replace(/\{video_url\}/gi,encodeURIComponent(t.macro.video_url)).replace(/\{video_title\}/gi,encodeURIComponent(t.macro.video_title)).replace(/\{autoplay\}/gi,encodeURIComponent(t.macro.autoplay)).replace(/\{mute\}/gi,encodeURIComponent(t.macro.mute)).replace(/\{video_id\}/gi,encodeURIComponent(t.macro.video_id)).replace(/\{ad_position\}/gi,encodeURIComponent(t.macro.ad_position)):e},prepareInternalUrl:function(e,t,n){return e=utils.prepareUrl(e,t,n),e=e.replace(/\{v\}/gi,encodeURIComponent(t.unitVersion)).replace(/\{tech\}/gi,"js")},prepareThirdPartyUrl:function(e,t,n){return e.replace(/\{advId\}/gi,t.isVm?0:t.advId).replace(/\{cmpId\}/gi,t.isVm?0:t.cmpId).replace(/\{channelid}/gi,t.isVm?0:n.pubId)},log:function(){return"undefined"==typeof localStorage||!localStorage.debug||localStorage.debug<1||"undefined"==typeof console||!console.log?function(){}:log}(),info:function(){return"undefined"==typeof localStorage||!localStorage.debug||localStorage.debug<2||"undefined"==typeof console||!console.log?function(){}:log}(),convertObjToSearchStr:function(e){var t="",n="";for(var o in e)e.hasOwnProperty(o)&&(t+=n+o+"="+encodeURIComponent(e[o]),n="&");return t},convertTimeStrToSeconds:function(e){var t=e.split(":");return 3!=t.length?0:60*t[0]*60+60*t[1]+1*t[2]},getRandomInt:function(e,t){return Math.round(Math.random()*(t-e))+e},uniteUrlPath:function(e,t){return t?(e=e.replace(/\/$/,""),t=t.replace(/^\//,""),e+"/"+t):e},isElementFocused:function(e){return!!this.getWinDoc(e).doc.hasFocus()&&document.activeElement===e},getElementViewportPosition:function(e){var t=0,n=0,o=0,i=0;if("function"==typeof e.getBoundingClientRect){var r=e.getBoundingClientRect();t=r.left,n=r.top,o=r.width,i=r.height}return{w:o,h:i,x:t,y:n}},getWinDoc:function(e){var t,n;try{t=e.ownerDocument,n=t.defaultView||t.parentWindow}catch(e){t=document,n=window}return{doc:t,win:n}},getViewportInfo:function(e){var t=this.getWinDoc(e).win;return{w:t.innerWidth||t.outherWidth||0,h:t.innerHeight||t.outherHeight||0}},getViewablePercent:function(e){var t=this.getElementViewportPosition(e),n=this.getViewportInfo(e),o=t.w*t.h,i=t.w,r=t.h;return t.x<1e-5&&(i+=t.x),t.y<1e-5&&(r+=t.y),t.x+t.w>n.w&&(i-=t.x+t.w-n.w),t.y+t.h>n.h&&(i-=t.y+t.h-n.h),i<1e-5?0:r<1e-5?0:o<1e-5?0:Math.round(i*r/o*100)},implementPubSub:function(e,t){return e=e||{},t=t||function(){return!0},e._events={},e.subscribe=function(e,t){return this._events[t]=this._events[t]||[],this._events[t].push(e),!0},e.unsubscribe=function(e,t){var n=this._events[t];if(!n)return!0;for(var o=0;o<n.length;o++)n[o]==e&&n.splice(o--,1);return!0},e.on=function(e,t){return this._events[e]=this._events[e]||[],this._events[e].push(t),!0},e.once=function(t,n){var o=function(){return e.off(t,o),n.apply(this,arguments)};return this._events[t]=this._events[t]||[],this._events[t].push(o),!0},e.off=function(e,t){var n=this._events[e];if(!n)return!0;for(var o=0;o<n.length;o++)n[o]==t&&n.splice(o--,1);return!0},e.emit=function(e,n){if(t(e,n)){var o=this._events[e];if(o)for(var i=0;i<o.length;i++)o[i](n)}},e},getTimer:function(e,t,n){return{timer:null,ms_played:0,tm_started:0,paused:!1,now:function(){return(new Date).getTime()},flush:function(){this.reset(),e()},start:function(){return utils.log(n+" start"),this.paused=!1,this.tm_started=this.now(),t-this.ms_played<0?this.flush():(this.timer=setTimeout(this.flush.bind(this),t-this.ms_played),this)},pause:function(){if(!this.paused){utils.log(n+" paused"),this.paused=!0;var e=this.now();null!==this.timer&&clearTimeout(this.timer),this.ms_played+=e-this.tm_started,this.tm_started=0}},reset:function(){null!==this.timer&&clearTimeout(this.timer),utils.log(n+" reset"),this.timer=null,this.paused=!1,this.ms_played=0,this.tm_started=0}}.start()},getAChain:function(e){for(var t=[],n=window;;)try{if(n.self===n.parent||!n.parent.location.href)break;n=n.parent,n.vm_aid&&t.push(n.vm_aid)}catch(e){break}return t.join()},getDefDomain:function(e){try{var t=url_parser.getHost(e);t=t.split(".");var n=t.length;return n<2?"":t[n-2]+"."+t[n-1]}catch(e){return""}},getCallLimitedFunc:function(e,t){var n=0;return function(){var o=(new Date).getTime();o-n<t||(n=o,e.apply(this,arguments))}},loadJson:function(e){return utils.ajaxLoad(e).catch(function(e){utils.log("can't load json",e)}).then(function(e){try{return JSON.parse(e)}catch(e){utils.log("can't parse json",e)}})},getUrl:function(e,t){return _.each(t,function(t,n){e+=(e.indexOf("?")<0?"?":"&")+n+"="+encodeURIComponent(t)}),e}};Object.defineProperty(Error.prototype,"toJSON",{value:function(){var e={};return Object.getOwnPropertyNames(this).forEach(function(t){e[t]=this[t]},this),e},configurable:!0,writable:!0}),module.exports=utils;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[14])


//# sourceMappingURL=bundle.map